# shocker

![https://lh7-us.googleusercontent.com/ixy4foRFQXU3bxtlw0-JGr9e_XqO0XyGauWuBhVFD9VJift433ERoOeF0kg_xEjQX8v1EqjpgdlrWJSLvWbxPtBdBCxhrFr4jn2XqX0EBgvFaMDtSKZjYL0g0mYcqB7U6cbihrhiSKqc](https://lh7-us.googleusercontent.com/ixy4foRFQXU3bxtlw0-JGr9e_XqO0XyGauWuBhVFD9VJift433ERoOeF0kg_xEjQX8v1EqjpgdlrWJSLvWbxPtBdBCxhrFr4jn2XqX0EBgvFaMDtSKZjYL0g0mYcqB7U6cbihrhiSKqc)

không thấy có domain, nhưng vẫn thử lưu shocker.htb vào /etc/hosts

tìm path ẩn

![https://lh7-us.googleusercontent.com/JF_80Ejn7HTCNRuTbZMOdA4O3W3d95HIMKHktx5DpaSaqBVOYwLkuhSx4UxdjIH9QBGgnF1RDWVHcDnkqhhnbUS2GY59fBldlZ_obd62ElCVCN7HesrEjXR5hDgWuOuUPQm962Fpsec_](https://lh7-us.googleusercontent.com/JF_80Ejn7HTCNRuTbZMOdA4O3W3d95HIMKHktx5DpaSaqBVOYwLkuhSx4UxdjIH9QBGgnF1RDWVHcDnkqhhnbUS2GY59fBldlZ_obd62ElCVCN7HesrEjXR5hDgWuOuUPQm962Fpsec_)

![https://lh7-us.googleusercontent.com/szhrGEBm9vh5TE9WUNRYH50AaS8fpfY6F1W2bJq5wouMXUz3j_EPHp8a3MbbZ56gRZFq9ShD5iDwAvcFS88C0UIMrxRbLRDRoMspiyI8ikTr83-HCD1Ylam8RAW-c7OtS-XmFnpOwh90](https://lh7-us.googleusercontent.com/szhrGEBm9vh5TE9WUNRYH50AaS8fpfY6F1W2bJq5wouMXUz3j_EPHp8a3MbbZ56gRZFq9ShD5iDwAvcFS88C0UIMrxRbLRDRoMspiyI8ikTr83-HCD1Ylam8RAW-c7OtS-XmFnpOwh90)

ko thấy subdomain

![https://lh7-us.googleusercontent.com/Y81KaxTl-yJWXcsdkrwE3C8B4n0dCoOFSj7Nr1P0YG2OO8n3M265D30hzET8dJ02pBDAMC-uogvU8aYF0JiqUHoApHCW5E6LBqfxP_BlFxw3hgJwQ7LQUriSmBLgimVv4WIM-39ezLUq](https://lh7-us.googleusercontent.com/Y81KaxTl-yJWXcsdkrwE3C8B4n0dCoOFSj7Nr1P0YG2OO8n3M265D30hzET8dJ02pBDAMC-uogvU8aYF0JiqUHoApHCW5E6LBqfxP_BlFxw3hgJwQ7LQUriSmBLgimVv4WIM-39ezLUq)

từ các thư mục ẩn tìm path cụ thể, lọc các extension thực thi

![https://lh7-us.googleusercontent.com/-YWm129ZudjDsEoSYsiShUDcFr6tYvriJUOn4XFHQ8GjnMncL0PDtTCi_U_s5_1lyVPzfQDuzn1JFo0O153ko3PTUwKzgU7Bwy-q3d5CjCGqaWOFHtwhbN8upyxDh68eT0_dV_jl4Alt](https://lh7-us.googleusercontent.com/-YWm129ZudjDsEoSYsiShUDcFr6tYvriJUOn4XFHQ8GjnMncL0PDtTCi_U_s5_1lyVPzfQDuzn1JFo0O153ko3PTUwKzgU7Bwy-q3d5CjCGqaWOFHtwhbN8upyxDh68eT0_dV_jl4Alt)

![https://lh7-us.googleusercontent.com/7kUyD5FS-bPj3eEH3aGiev6DCV3jXs19pa4Hw_-eysPjcFezmELHfP3LQsvK4dqFtgIQi0Op1iGnRzcrMPpG8m6Di_3RipgQ5YrkrJCDRvFaCEGMihM1vvYzTzfRQ7tTA8N0mX0aFeqP](https://lh7-us.googleusercontent.com/7kUyD5FS-bPj3eEH3aGiev6DCV3jXs19pa4Hw_-eysPjcFezmELHfP3LQsvK4dqFtgIQi0Op1iGnRzcrMPpG8m6Di_3RipgQ5YrkrJCDRvFaCEGMihM1vvYzTzfRQ7tTA8N0mX0aFeqP)

trông giống như kết quả của câu lệnh uptime

![https://lh7-us.googleusercontent.com/gB0mcwGvm2rOqJiKQRr6pVN93Mlb7LKwwnZH2Jj851ULxxa3LhDlWWdvUJ_xd957VtdpFz7W1WovzICZeKRC42ulq9dKeoPtDvjJYvrh5D4fms_JZhAI2nKWmVJJzY-_VB4T3TnTIj2Z](https://lh7-us.googleusercontent.com/gB0mcwGvm2rOqJiKQRr6pVN93Mlb7LKwwnZH2Jj851ULxxa3LhDlWWdvUJ_xd957VtdpFz7W1WovzICZeKRC42ulq9dKeoPtDvjJYvrh5D4fms_JZhAI2nKWmVJJzY-_VB4T3TnTIj2Z)

try shellshock

kiểm tra:

nmap 10.10.10.56 -p 80 --script=http-shellshock --script-args uri=/cgi-bin/user.sh

![https://lh7-us.googleusercontent.com/9y_o3SwGid1vYcsHUuBw_Kfl2sgykFjFxFqWUAXlCRAQSwAdzYLoREY4_kR-Cgx-IDPICMO71y7c-Y-wdsUsrO4s-iEwzk6TB384f3pcJ8vsnK556fT3yWimV_w6yevTXZtJB1aFBOJj](https://lh7-us.googleusercontent.com/9y_o3SwGid1vYcsHUuBw_Kfl2sgykFjFxFqWUAXlCRAQSwAdzYLoREY4_kR-Cgx-IDPICMO71y7c-Y-wdsUsrO4s-iEwzk6TB384f3pcJ8vsnK556fT3yWimV_w6yevTXZtJB1aFBOJj)

You could **find** this vulnerability noticing that it is using an **old Apache version** and **cgi_mod** (with cgi folder).

cve-2014-6271 This vulnerability impacts the Bourne Again Shell "Bash". Bash is not usually available through a web application but can be indirectly exposed through a Common Gateway Interface "CGI".It allowed an attacker to execute commands in places where it should only be doing something safe like defining an environment variable. An initial POC was this:

env x='() { :;}; echo vulnerable' bash -c "echo this is a test"

() { :;};: Phần này là lỗ hổng Shellshock. Nó cố ý tạo ra một hàm trong bash không có nội dung thực sự, sau đó đặt một dấu phẩy và lệnh đóng ngoặc nhưng không kết thúc hàm. Điều này khiến Bash "lú lẫn" và thực thi câu lệnh tiếp theo mà không kiểm tra xác thực.

![https://lh7-us.googleusercontent.com/22c-p9IYhib3M_sIGKU3pTIETKFgJWiHIrWyV_5hohgxAB-f0Hn6OKIgk5X001DRFpAxC3lWrI0hscWe7j3YwD7TIH7n51vpl77-UjihjHVWoJLqrTtEdA0p9Tu4Kydzmz2DKL_FXoC3](https://lh7-us.googleusercontent.com/22c-p9IYhib3M_sIGKU3pTIETKFgJWiHIrWyV_5hohgxAB-f0Hn6OKIgk5X001DRFpAxC3lWrI0hscWe7j3YwD7TIH7n51vpl77-UjihjHVWoJLqrTtEdA0p9Tu4Kydzmz2DKL_FXoC3)

thấy có user shelly

![https://lh7-us.googleusercontent.com/Q4lbZz8AK-4xMUjfHBedMG9GKojQiyhrFebyGPoHr_7XH5X72DZGvQCMYeDtTXlEsdzuxAh60KCGoUg_bGjE03OjwOZhhks_yW4k2_lS4W2S31v0_hrr57gZy_eWVFNQni9H5FoDEGMj](https://lh7-us.googleusercontent.com/Q4lbZz8AK-4xMUjfHBedMG9GKojQiyhrFebyGPoHr_7XH5X72DZGvQCMYeDtTXlEsdzuxAh60KCGoUg_bGjE03OjwOZhhks_yW4k2_lS4W2S31v0_hrr57gZy_eWVFNQni9H5FoDEGMj)

![https://lh7-us.googleusercontent.com/B8haMpw2ZEJaJVadedjCPIGquqWZ4aqD1-zk-EGmwZ4Yr0bSirVexXkuqbVHeH2uH7Sj7H-UY0aV4R5GCz9vOlDnvKzSHBI9EmPiJaYpfCHylf7MqDzdufpYQsKS4zSIedDsN8gSxHvO](https://lh7-us.googleusercontent.com/B8haMpw2ZEJaJVadedjCPIGquqWZ4aqD1-zk-EGmwZ4Yr0bSirVexXkuqbVHeH2uH7Sj7H-UY0aV4R5GCz9vOlDnvKzSHBI9EmPiJaYpfCHylf7MqDzdufpYQsKS4zSIedDsN8gSxHvO)

có flag user

![https://lh7-us.googleusercontent.com/WTzCyXfAkTC9M1wpWclauBwf_pnLopRF2txwg0eUu6vQhCZJdTHvqDVLMmZpsXeRO7WJW68gJ6QXlvQ77CgXu-6-dMLJT55I0CtokAj_pR9HW_BJXbstpEQ16CqbOhu5TV2Molz-Xyn5](https://lh7-us.googleusercontent.com/WTzCyXfAkTC9M1wpWclauBwf_pnLopRF2txwg0eUu6vQhCZJdTHvqDVLMmZpsXeRO7WJW68gJ6QXlvQ77CgXu-6-dMLJT55I0CtokAj_pR9HW_BJXbstpEQ16CqbOhu5TV2Molz-Xyn5)

tạo reverse shell

![https://lh7-us.googleusercontent.com/FoN73gYvdEYFctI1JfBRL2fa6lIRfh80R_7eRXaz-lVqX14t3AJ0hucVsDC6ppfMcXWGCouwq17rbJU5IEGrmnk_He5PDzjHHedaeRKvSyOn4svmQk8E7EwWZ__Nv8PkfRUoGJTxLZtL](https://lh7-us.googleusercontent.com/FoN73gYvdEYFctI1JfBRL2fa6lIRfh80R_7eRXaz-lVqX14t3AJ0hucVsDC6ppfMcXWGCouwq17rbJU5IEGrmnk_He5PDzjHHedaeRKvSyOn4svmQk8E7EwWZ__Nv8PkfRUoGJTxLZtL)

![https://lh7-us.googleusercontent.com/SM3zAy1KdCCaeDYS_EEeIFrdPQ70xVJWsYANql8HE07lHjgiZEW79cFmaHMbIFxo1v8e5jgMPz1DJqLfHyhxR0apEvyfxlus924W4CUqlywe8uU2oGNBF-xBZc2XxXGksE6SWUqAyGO0](https://lh7-us.googleusercontent.com/SM3zAy1KdCCaeDYS_EEeIFrdPQ70xVJWsYANql8HE07lHjgiZEW79cFmaHMbIFxo1v8e5jgMPz1DJqLfHyhxR0apEvyfxlus924W4CUqlywe8uU2oGNBF-xBZc2XxXGksE6SWUqAyGO0)

![https://lh7-us.googleusercontent.com/HkYZOCLJIBPy3XLnhpqlAcHmVggfWJ8GFU-gPrxyKAhSQufKv_7oCaLiq3F3agsX_UUibxKjdCnfjPWyHOCZhb1KltwrI3SCdXN2GRS8XBFnFK3-vqHN5UYPKUv07w4vblrV2IFXRZhr](https://lh7-us.googleusercontent.com/HkYZOCLJIBPy3XLnhpqlAcHmVggfWJ8GFU-gPrxyKAhSQufKv_7oCaLiq3F3agsX_UUibxKjdCnfjPWyHOCZhb1KltwrI3SCdXN2GRS8XBFnFK3-vqHN5UYPKUv07w4vblrV2IFXRZhr)

tìm thấy shelly có thể thực thi perl dưới quyền sudo mà ko cần pw

![https://lh7-us.googleusercontent.com/Ok4H3FreoRN0HMsAvy84u2EGNhsdLR-lT_a8T0I7qVAvS-gJjgK0qiUOTU4vTmYxnqhD-aDOA6d9kcDVe8loGmljGOF-m1atXnv8GKA-gF7gjfNwd07lLC5MHgd08FCjDNglnAARGFC7](https://lh7-us.googleusercontent.com/Ok4H3FreoRN0HMsAvy84u2EGNhsdLR-lT_a8T0I7qVAvS-gJjgK0qiUOTU4vTmYxnqhD-aDOA6d9kcDVe8loGmljGOF-m1atXnv8GKA-gF7gjfNwd07lLC5MHgd08FCjDNglnAARGFC7)

tham khảo gtfoBins perl

![https://lh7-us.googleusercontent.com/PdQ7q76iuDHrPiTdxfUmxMi6t_Z93dh2j-donkJGBJCX6eW_BOUMRts9X0Jx9yBm4pUSY_VCDgUo63Wynttz6Ot8PpMrQcO5-Sjv4rnXNCfz9cnOiStMXaE99A22uDbfrkS4Q4rzeNl0](https://lh7-us.googleusercontent.com/PdQ7q76iuDHrPiTdxfUmxMi6t_Z93dh2j-donkJGBJCX6eW_BOUMRts9X0Jx9yBm4pUSY_VCDgUo63Wynttz6Ot8PpMrQcO5-Sjv4rnXNCfz9cnOiStMXaE99A22uDbfrkS4Q4rzeNl0)

-e allows you to define Perl code to be executed by the compiler

![https://lh7-us.googleusercontent.com/hKKwKaNn5HS6v8aA3GJDlxYxwGuGV23S8xjf8CXPf-twBpCCTMtoNyBrW_ypKDvOjM9tU_CsZQ4VcM5r2q9egkNuKgsC548S8uBCFNhblLEor31w-JdmW0W_zlt3C59Hf6MZHN3ZS6l_](https://lh7-us.googleusercontent.com/hKKwKaNn5HS6v8aA3GJDlxYxwGuGV23S8xjf8CXPf-twBpCCTMtoNyBrW_ypKDvOjM9tU_CsZQ4VcM5r2q9egkNuKgsC548S8uBCFNhblLEor31w-JdmW0W_zlt3C59Hf6MZHN3ZS6l_)

![https://lh7-us.googleusercontent.com/qGeCMtlti8WjhkVi7cHF6qmdDTiQceKA5kHd0u6aadTICDscDs31DjLeA8zOTc5DQbGWcicc5Y79Fumx3ouCSPmepshW4Vh70BULddtRmW09hoCerXz_yi1bgysvM2H9M1tPiC3NAiaV](https://lh7-us.googleusercontent.com/qGeCMtlti8WjhkVi7cHF6qmdDTiQceKA5kHd0u6aadTICDscDs31DjLeA8zOTc5DQbGWcicc5Y79Fumx3ouCSPmepshW4Vh70BULddtRmW09hoCerXz_yi1bgysvM2H9M1tPiC3NAiaV)